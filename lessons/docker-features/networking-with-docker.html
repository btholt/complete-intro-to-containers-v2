<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/x-icon" href="/images/favicon.ico"/><title>Networking with Docker – Complete Intro to Containers</title><meta name="description" content="Learn how to perform manual networking with Docker, understanding Docker Compose and Kubernetes roles. Explore connecting a Node.js app to a MongoDB database using Docker networks. Discover basic networking concepts within Docker, such as bridge networks, and connect containers through custom networks."/><meta name="keywords" content="Docker networking,manual networking,Node.js app,MongoDB database,bridge networks,connecting containers,basic Docker networking"/><meta name="og:description" content="Learn how to perform manual networking with Docker, understanding Docker Compose and Kubernetes roles. Explore connecting a Node.js app to a MongoDB database using Docker networks. Discover basic networking concepts within Docker, such as bridge networks, and connect containers through custom networks."/><meta name="og:title" content="Networking with Docker – Complete Intro to Containers"/><meta name="og:image" content="/images/social-share-cover.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="next-head-count" content="14"/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/cfac17cb37b27821.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/cfac17cb37b27821.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-4e7214a60fad8e88.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-5429a50ba5373c56.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-d2ba44903cd47711.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-564cf6bb10408614.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-ba225542c35827e2.js" defer="" crossorigin=""></script><script src="/_next/static/nARcRKX1ZlcrYUdSUSS9z/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/nARcRKX1ZlcrYUdSUSS9z/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Complete Intro to Containers</a></h1><div class="navbar-info"><a href="https://holt.fyi/containers" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><p>This is not going to be a deep dive into how networking works. Networking is a deep, deep pool of knowledge and merits entire courses to understand. Just worrying about networking is some people&#39;s jobs due to the immense surface area of the subject. Instead, I want to just peek under the covers of how to do manual networking with Docker so you can understand what Docker Compose and Kubernetes do for you.</p>
<p>So why do we care about networking? Many reasons! Let&#39;s make our Node.js app a bit more complicated. What if it had a database? Let&#39;s connect it to a running MongoDB database. We <em>could</em> start this MongoDB database inside of the same container and this might be fine for development on the smallest app but it&#39;d be better and easier if we could just use the <a href="https://hub.docker.com/_/mongo">mongo</a> container directly. But if I have two containers running at the same time (the app containers and the MongoDB container) how do they talk to each other? Networking!</p>
<p>There are several ways of doing networking within Docker and all of them work differently depending which operating system you&#39;re on. Again, this is a deep subject and we&#39;re just going to skim the surface. We&#39;re going to deal with the simplest, the bridge networks. There is a default bridge network running all the time. If you want to check this out, run <code>docker network ls</code>. You&#39;ll see something like this:</p>
<pre><code class="hljs language-bash">$ docker network <span class="hljs-built_in">ls</span>
NETWORK ID          NAME                DRIVER              SCOPE
xxxxxxxxxxxx        bridge              bridge              <span class="hljs-built_in">local</span>
xxxxxxxxxxxx        host                host                <span class="hljs-built_in">local</span>
xxxxxxxxxxxx        none                null                <span class="hljs-built_in">local</span>
</code></pre><p>The bridge network is the one that exists all the time and we could attach to it if we want to, but again Docker recommends against it so we&#39;ll create our own. There&#39;s also the host network which is the host computer itself&#39;s network. The last network with the <code>null</code> driver is one that you&#39;d use if you wanted to use some other provider or if you wanted to do it manually yourself.</p>
<pre><code class="hljs language-bash"><span class="hljs-comment"># create the network</span>
docker network create --driver=bridge app-net

<span class="hljs-comment"># start the mongodb server</span>
docker run -d --network=app-net -p 27017:27017 --name=db --<span class="hljs-built_in">rm</span> mongo:7
</code></pre><p>I&#39;m having you run a specific version of MongoDB, v7, because I know the package to interact with it is already available on Ubuntu. Feel free to use v8+ if you know it&#39;s available. We also added a few flags. The <code>--name</code> flag allows us to refer specifically to that one running container, and even better it allows us to use that as its address on the network. We&#39;ll see that in a sec. The one other, since we&#39;re using <code>--name</code> is <code>--rm</code>. If we didn&#39;t use that, we&#39;d have to run <code>docker rm db</code> before restarting our <code>db</code> container since when it stops a container, it doesn&#39;t delete it and its logs and meta data until you tell it to. The <code>--rm</code> means toss all that stuff as soon as the container finishes and free up that name again.</p>
<p>Now, for fun we can use <em>another</em> MongoDB containter (because it has the <code>mongosh</code> client on it in addition to have the MongoDB server).</p>
<pre><code class="hljs language-bash">docker run -it --network=app-net --<span class="hljs-built_in">rm</span> mongo:7 mongosh --host db
</code></pre><p>This will be one instance of a MongoDB container connecting to a different container over our Docker network. Cool, right? So let&#39;s make our Node.js app read and write to MongoDB!</p>
<h2>Connecting our Node.js App to MongoDB</h2>
<p>This isn&#39;t a course in MongoDB or anything but more just to show you how to connect one app container to a database container as well as set you up for the next lesson Docker composes. And this sort of method work just as well for any DB: MySQL, Postgres, Redis, etc.</p>
<p>So first thing, let&#39;s add some logic to our app that reads and writes to MongoDB</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> fastify = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fastify&quot;</span>)({ <span class="hljs-attr">logger</span>: <span class="hljs-literal">true</span> });
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">MongoClient</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;mongodb&quot;</span>);
<span class="hljs-keyword">const</span> url = process.<span class="hljs-property">env</span>.<span class="hljs-property">MONGO_CONNECTION_STRING</span> || <span class="hljs-string">&quot;mongodb://localhost:27017&quot;</span>;
<span class="hljs-keyword">const</span> dbName = <span class="hljs-string">&quot;dockerApp&quot;</span>;
<span class="hljs-keyword">const</span> collectionName = <span class="hljs-string">&quot;count&quot;</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">await</span> <span class="hljs-title class_">MongoClient</span>.<span class="hljs-title function_">connect</span>(url);
  <span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(dbName);
  <span class="hljs-keyword">const</span> collection = db.<span class="hljs-title function_">collection</span>(collectionName);

  fastify.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handler</span>(<span class="hljs-params">request, reply</span>) {
    <span class="hljs-keyword">const</span> count = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">countDocuments</span>();
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, count };
  });

  fastify.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/add&quot;</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handler</span>(<span class="hljs-params">request, reply</span>) {
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">insertOne</span>({});
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">acknowledged</span>: res.<span class="hljs-property">acknowledged</span> };
  });

  fastify.<span class="hljs-title function_">listen</span>({ <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span>, <span class="hljs-attr">host</span>: <span class="hljs-string">&quot;0.0.0.0&quot;</span> }, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) {
      fastify.<span class="hljs-property">log</span>.<span class="hljs-title function_">error</span>(err);
      process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
    }
  });
}

<span class="hljs-title function_">start</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err);
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
});
</code></pre><p><a href="https://github.com/btholt/project-files-for-complete-intro-to-containers-v2/blob/main/networking-with-docker">⛓️ Link to the project files</a></p>
<blockquote>
<p>Open the project files to this above directory so you can get the right dependencies and Dockerfile. Make sure you run <code>npm install</code>.</p>
</blockquote>
<p>This is pretty similar to the project we ran before in the Layers section. We&#39;re just reading and writing to MongoDB now in the Node.js server, but we&#39;re using otherwise everything else the same including the same Dockerfile.</p>
<p>You could absolutely run this locally if you have MongoDB running on your host machine since the default connection string will connect to a local MonogDB. But we also left it open so we can feed the app an environmental variable so we can modify it to be a different container.</p>
<p>So build the container and run it using the following commands:</p>
<pre><code class="hljs language-bash">docker build --tag=my-app-with-mongo .
docker run -p 8080:8080 --network=app-net --init --<span class="hljs-built_in">env</span> MONGO_CONNECTION_STRING=mongodb://db:27017 my-app-with-mongo
</code></pre><p>Okay so we added a new endpoint and modified one. The first one is <code>/add</code> which will add an empty object (MongoDB will add an <code>_id</code> to it so it&#39;s not totally empty). It will then return how many items it successfully added to MongoDB (hopefully 1!). And then we modified the <code>/</code> route to return the count of items in the database. Great! This is how the basics of networking work in Docker.</p>
<p>One key thing here that we need to discuss: if you shut down that one Docker container, where is your data going to go? Well, it&#39;ll disappear. How do you mitigate this? Usually with some sort of volume that lives beyond the container, and usually by having more than one container of MongoDB running. It&#39;s beyond the scope of this course but you already have the tools you need to be able to do that.</p>
<p>Congrats! You&#39;ve done basic networking in Docker. Now let&#39;s go use other tools to make this easier for us.</p>
</div><div class="lesson-links"><a href="/lessons/docker-features/dev-containers" class="prev">← Previous</a><a href="/lessons/multi-container-projects/docker-compose" class="next">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="40" height="32" viewBox="0 0 40 32"><defs><clipPath id="clip-twitter-social"><rect width="40" height="32"></rect></clipPath></defs><g id="twitter-social" clip-path="url(#clip-twitter-social)"><g id="Group_269" data-name="Group 269" transform="translate(-230.23 -1140.849)"><path id="Path_419" data-name="Path 419" d="M266.12,1148.861v1.035a23.092,23.092,0,0,1-1.507,8.1,24.08,24.08,0,0,1-4.475,7.381,22.175,22.175,0,0,1-7.306,5.4,24.129,24.129,0,0,1-10,2.07,23.7,23.7,0,0,1-6.667-.945,22.83,22.83,0,0,1-5.936-2.655q.959.091,1.963.09a16.518,16.518,0,0,0,5.434-.9,17.111,17.111,0,0,0,4.749-2.52,8.275,8.275,0,0,1-4.749-1.643,7.8,7.8,0,0,1-2.877-3.983,8.268,8.268,0,0,0,1.507.135,8.58,8.58,0,0,0,2.146-.27,8.16,8.16,0,0,1-5.685-4.344,8.326,8.326,0,0,1-.89-3.578v-.135a7.775,7.775,0,0,0,3.744,1.035,8.183,8.183,0,0,1-2.671-2.9,7.817,7.817,0,0,1-.982-3.848,7.948,7.948,0,0,1,1.1-4.05,23.53,23.53,0,0,0,16.895,8.46,9.221,9.221,0,0,1-.183-1.845,7.787,7.787,0,0,1,1.1-4.05,8.216,8.216,0,0,1,2.991-2.948,7.991,7.991,0,0,1,4.087-1.1,8.184,8.184,0,0,1,5.982,2.566,16.087,16.087,0,0,0,5.205-1.98,7.784,7.784,0,0,1-1.393,2.588,8.4,8.4,0,0,1-2.215,1.913,16.856,16.856,0,0,0,4.749-1.305A17.032,17.032,0,0,1,266.12,1148.861Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Excercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul></footer></div><script async="" defer="" src="https://a.holt.courses/latest.js"></script><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"post":{"attributes":{"description":"Learn how to perform manual networking with Docker, understanding Docker Compose and Kubernetes roles. Explore connecting a Node.js app to a MongoDB database using Docker networks. Discover basic networking concepts within Docker, such as bridge networks, and connect containers through custom networks.","keywords":["Docker networking","manual networking","Node.js app","MongoDB database","bridge networks","connecting containers","basic Docker networking"]},"html":"\u003cp\u003eThis is not going to be a deep dive into how networking works. Networking is a deep, deep pool of knowledge and merits entire courses to understand. Just worrying about networking is some people\u0026#39;s jobs due to the immense surface area of the subject. Instead, I want to just peek under the covers of how to do manual networking with Docker so you can understand what Docker Compose and Kubernetes do for you.\u003c/p\u003e\n\u003cp\u003eSo why do we care about networking? Many reasons! Let\u0026#39;s make our Node.js app a bit more complicated. What if it had a database? Let\u0026#39;s connect it to a running MongoDB database. We \u003cem\u003ecould\u003c/em\u003e start this MongoDB database inside of the same container and this might be fine for development on the smallest app but it\u0026#39;d be better and easier if we could just use the \u003ca href=\"https://hub.docker.com/_/mongo\"\u003emongo\u003c/a\u003e container directly. But if I have two containers running at the same time (the app containers and the MongoDB container) how do they talk to each other? Networking!\u003c/p\u003e\n\u003cp\u003eThere are several ways of doing networking within Docker and all of them work differently depending which operating system you\u0026#39;re on. Again, this is a deep subject and we\u0026#39;re just going to skim the surface. We\u0026#39;re going to deal with the simplest, the bridge networks. There is a default bridge network running all the time. If you want to check this out, run \u003ccode\u003edocker network ls\u003c/code\u003e. You\u0026#39;ll see something like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ docker network \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\nNETWORK ID          NAME                DRIVER              SCOPE\nxxxxxxxxxxxx        bridge              bridge              \u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003e\nxxxxxxxxxxxx        host                host                \u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003e\nxxxxxxxxxxxx        none                null                \u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThe bridge network is the one that exists all the time and we could attach to it if we want to, but again Docker recommends against it so we\u0026#39;ll create our own. There\u0026#39;s also the host network which is the host computer itself\u0026#39;s network. The last network with the \u003ccode\u003enull\u003c/code\u003e driver is one that you\u0026#39;d use if you wanted to use some other provider or if you wanted to do it manually yourself.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e# create the network\u003c/span\u003e\ndocker network create --driver=bridge app-net\n\n\u003cspan class=\"hljs-comment\"\u003e# start the mongodb server\u003c/span\u003e\ndocker run -d --network=app-net -p 27017:27017 --name=db --\u003cspan class=\"hljs-built_in\"\u003erm\u003c/span\u003e mongo:7\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eI\u0026#39;m having you run a specific version of MongoDB, v7, because I know the package to interact with it is already available on Ubuntu. Feel free to use v8+ if you know it\u0026#39;s available. We also added a few flags. The \u003ccode\u003e--name\u003c/code\u003e flag allows us to refer specifically to that one running container, and even better it allows us to use that as its address on the network. We\u0026#39;ll see that in a sec. The one other, since we\u0026#39;re using \u003ccode\u003e--name\u003c/code\u003e is \u003ccode\u003e--rm\u003c/code\u003e. If we didn\u0026#39;t use that, we\u0026#39;d have to run \u003ccode\u003edocker rm db\u003c/code\u003e before restarting our \u003ccode\u003edb\u003c/code\u003e container since when it stops a container, it doesn\u0026#39;t delete it and its logs and meta data until you tell it to. The \u003ccode\u003e--rm\u003c/code\u003e means toss all that stuff as soon as the container finishes and free up that name again.\u003c/p\u003e\n\u003cp\u003eNow, for fun we can use \u003cem\u003eanother\u003c/em\u003e MongoDB containter (because it has the \u003ccode\u003emongosh\u003c/code\u003e client on it in addition to have the MongoDB server).\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003edocker run -it --network=app-net --\u003cspan class=\"hljs-built_in\"\u003erm\u003c/span\u003e mongo:7 mongosh --host db\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis will be one instance of a MongoDB container connecting to a different container over our Docker network. Cool, right? So let\u0026#39;s make our Node.js app read and write to MongoDB!\u003c/p\u003e\n\u003ch2\u003eConnecting our Node.js App to MongoDB\u003c/h2\u003e\n\u003cp\u003eThis isn\u0026#39;t a course in MongoDB or anything but more just to show you how to connect one app container to a database container as well as set you up for the next lesson Docker composes. And this sort of method work just as well for any DB: MySQL, Postgres, Redis, etc.\u003c/p\u003e\n\u003cp\u003eSo first thing, let\u0026#39;s add some logic to our app that reads and writes to MongoDB\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fastify = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;fastify\u0026quot;\u003c/span\u003e)({ \u003cspan class=\"hljs-attr\"\u003elogger\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e });\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eMongoClient\u003c/span\u003e } = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;mongodb\u0026quot;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e url = process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eMONGO_CONNECTION_STRING\u003c/span\u003e || \u003cspan class=\"hljs-string\"\u003e\u0026quot;mongodb://localhost:27017\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e dbName = \u003cspan class=\"hljs-string\"\u003e\u0026quot;dockerApp\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e collectionName = \u003cspan class=\"hljs-string\"\u003e\u0026quot;count\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003estart\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e client = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eMongoClient\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003econnect\u003c/span\u003e(url);\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e db = client.\u003cspan class=\"hljs-title function_\"\u003edb\u003c/span\u003e(dbName);\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e collection = db.\u003cspan class=\"hljs-title function_\"\u003ecollection\u003c/span\u003e(collectionName);\n\n  fastify.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ehandler\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003erequest, reply\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e count = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e collection.\u003cspan class=\"hljs-title function_\"\u003ecountDocuments\u003c/span\u003e();\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e { \u003cspan class=\"hljs-attr\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, count };\n  });\n\n  fastify.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/add\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ehandler\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003erequest, reply\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e res = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e collection.\u003cspan class=\"hljs-title function_\"\u003einsertOne\u003c/span\u003e({});\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e { \u003cspan class=\"hljs-attr\"\u003eacknowledged\u003c/span\u003e: res.\u003cspan class=\"hljs-property\"\u003eacknowledged\u003c/span\u003e };\n  });\n\n  fastify.\u003cspan class=\"hljs-title function_\"\u003elisten\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003eport\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ehost\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;0.0.0.0\u0026quot;\u003c/span\u003e }, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (err) {\n      fastify.\u003cspan class=\"hljs-property\"\u003elog\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eerror\u003c/span\u003e(err);\n      process.\u003cspan class=\"hljs-title function_\"\u003eexit\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n    }\n  });\n}\n\n\u003cspan class=\"hljs-title function_\"\u003estart\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003ecatch\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(err);\n  process.\u003cspan class=\"hljs-title function_\"\u003eexit\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca href=\"https://github.com/btholt/project-files-for-complete-intro-to-containers-v2/blob/main/networking-with-docker\"\u003e⛓️ Link to the project files\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eOpen the project files to this above directory so you can get the right dependencies and Dockerfile. Make sure you run \u003ccode\u003enpm install\u003c/code\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThis is pretty similar to the project we ran before in the Layers section. We\u0026#39;re just reading and writing to MongoDB now in the Node.js server, but we\u0026#39;re using otherwise everything else the same including the same Dockerfile.\u003c/p\u003e\n\u003cp\u003eYou could absolutely run this locally if you have MongoDB running on your host machine since the default connection string will connect to a local MonogDB. But we also left it open so we can feed the app an environmental variable so we can modify it to be a different container.\u003c/p\u003e\n\u003cp\u003eSo build the container and run it using the following commands:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003edocker build --tag=my-app-with-mongo .\ndocker run -p 8080:8080 --network=app-net --init --\u003cspan class=\"hljs-built_in\"\u003eenv\u003c/span\u003e MONGO_CONNECTION_STRING=mongodb://db:27017 my-app-with-mongo\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eOkay so we added a new endpoint and modified one. The first one is \u003ccode\u003e/add\u003c/code\u003e which will add an empty object (MongoDB will add an \u003ccode\u003e_id\u003c/code\u003e to it so it\u0026#39;s not totally empty). It will then return how many items it successfully added to MongoDB (hopefully 1!). And then we modified the \u003ccode\u003e/\u003c/code\u003e route to return the count of items in the database. Great! This is how the basics of networking work in Docker.\u003c/p\u003e\n\u003cp\u003eOne key thing here that we need to discuss: if you shut down that one Docker container, where is your data going to go? Well, it\u0026#39;ll disappear. How do you mitigate this? Usually with some sort of volume that lives beyond the container, and usually by having more than one container of MongoDB running. It\u0026#39;s beyond the scope of this course but you already have the tools you need to be able to do that.\u003c/p\u003e\n\u003cp\u003eCongrats! You\u0026#39;ve done basic networking in Docker. Now let\u0026#39;s go use other tools to make this easier for us.\u003c/p\u003e\n","markdown":"\nThis is not going to be a deep dive into how networking works. Networking is a deep, deep pool of knowledge and merits entire courses to understand. Just worrying about networking is some people's jobs due to the immense surface area of the subject. Instead, I want to just peek under the covers of how to do manual networking with Docker so you can understand what Docker Compose and Kubernetes do for you.\n\nSo why do we care about networking? Many reasons! Let's make our Node.js app a bit more complicated. What if it had a database? Let's connect it to a running MongoDB database. We _could_ start this MongoDB database inside of the same container and this might be fine for development on the smallest app but it'd be better and easier if we could just use the [mongo][mongo] container directly. But if I have two containers running at the same time (the app containers and the MongoDB container) how do they talk to each other? Networking!\n\nThere are several ways of doing networking within Docker and all of them work differently depending which operating system you're on. Again, this is a deep subject and we're just going to skim the surface. We're going to deal with the simplest, the bridge networks. There is a default bridge network running all the time. If you want to check this out, run `docker network ls`. You'll see something like this:\n\n```bash\n$ docker network ls\nNETWORK ID          NAME                DRIVER              SCOPE\nxxxxxxxxxxxx        bridge              bridge              local\nxxxxxxxxxxxx        host                host                local\nxxxxxxxxxxxx        none                null                local\n```\n\nThe bridge network is the one that exists all the time and we could attach to it if we want to, but again Docker recommends against it so we'll create our own. There's also the host network which is the host computer itself's network. The last network with the `null` driver is one that you'd use if you wanted to use some other provider or if you wanted to do it manually yourself.\n\n```bash\n# create the network\ndocker network create --driver=bridge app-net\n\n# start the mongodb server\ndocker run -d --network=app-net -p 27017:27017 --name=db --rm mongo:7\n```\n\nI'm having you run a specific version of MongoDB, v7, because I know the package to interact with it is already available on Ubuntu. Feel free to use v8+ if you know it's available. We also added a few flags. The `--name` flag allows us to refer specifically to that one running container, and even better it allows us to use that as its address on the network. We'll see that in a sec. The one other, since we're using `--name` is `--rm`. If we didn't use that, we'd have to run `docker rm db` before restarting our `db` container since when it stops a container, it doesn't delete it and its logs and meta data until you tell it to. The `--rm` means toss all that stuff as soon as the container finishes and free up that name again.\n\nNow, for fun we can use _another_ MongoDB containter (because it has the `mongosh` client on it in addition to have the MongoDB server).\n\n```bash\ndocker run -it --network=app-net --rm mongo:7 mongosh --host db\n```\n\nThis will be one instance of a MongoDB container connecting to a different container over our Docker network. Cool, right? So let's make our Node.js app read and write to MongoDB!\n\n## Connecting our Node.js App to MongoDB\n\nThis isn't a course in MongoDB or anything but more just to show you how to connect one app container to a database container as well as set you up for the next lesson Docker composes. And this sort of method work just as well for any DB: MySQL, Postgres, Redis, etc.\n\nSo first thing, let's add some logic to our app that reads and writes to MongoDB\n\n```javascript\nconst fastify = require(\"fastify\")({ logger: true });\nconst { MongoClient } = require(\"mongodb\");\nconst url = process.env.MONGO_CONNECTION_STRING || \"mongodb://localhost:27017\";\nconst dbName = \"dockerApp\";\nconst collectionName = \"count\";\n\nasync function start() {\n  const client = await MongoClient.connect(url);\n  const db = client.db(dbName);\n  const collection = db.collection(collectionName);\n\n  fastify.get(\"/\", async function handler(request, reply) {\n    const count = await collection.countDocuments();\n    return { success: true, count };\n  });\n\n  fastify.get(\"/add\", async function handler(request, reply) {\n    const res = await collection.insertOne({});\n    return { acknowledged: res.acknowledged };\n  });\n\n  fastify.listen({ port: 8080, host: \"0.0.0.0\" }, (err) =\u003e {\n    if (err) {\n      fastify.log.error(err);\n      process.exit(1);\n    }\n  });\n}\n\nstart().catch((err) =\u003e {\n  console.log(err);\n  process.exit(1);\n});\n```\n\n[⛓️ Link to the project files][project]\n\n\u003e Open the project files to this above directory so you can get the right dependencies and Dockerfile. Make sure you run `npm install`.\n\nThis is pretty similar to the project we ran before in the Layers section. We're just reading and writing to MongoDB now in the Node.js server, but we're using otherwise everything else the same including the same Dockerfile.\n\nYou could absolutely run this locally if you have MongoDB running on your host machine since the default connection string will connect to a local MonogDB. But we also left it open so we can feed the app an environmental variable so we can modify it to be a different container.\n\nSo build the container and run it using the following commands:\n\n```bash\ndocker build --tag=my-app-with-mongo .\ndocker run -p 8080:8080 --network=app-net --init --env MONGO_CONNECTION_STRING=mongodb://db:27017 my-app-with-mongo\n```\n\nOkay so we added a new endpoint and modified one. The first one is `/add` which will add an empty object (MongoDB will add an `_id` to it so it's not totally empty). It will then return how many items it successfully added to MongoDB (hopefully 1!). And then we modified the `/` route to return the count of items in the database. Great! This is how the basics of networking work in Docker.\n\nOne key thing here that we need to discuss: if you shut down that one Docker container, where is your data going to go? Well, it'll disappear. How do you mitigate this? Usually with some sort of volume that lives beyond the container, and usually by having more than one container of MongoDB running. It's beyond the scope of this course but you already have the tools you need to be able to do that.\n\nCongrats! You've done basic networking in Docker. Now let's go use other tools to make this easier for us.\n\n[mongo]: https://hub.docker.com/_/mongo\n[project]: https://github.com/btholt/project-files-for-complete-intro-to-containers-v2/blob/main/networking-with-docker\n","slug":"networking-with-docker","title":"Networking with Docker","section":"Docker Features","icon":"box","filePath":"/home/runner/work/complete-intro-to-containers-v2/complete-intro-to-containers-v2/lessons/06-docker-features/D-networking-with-docker.md","nextSlug":"/lessons/multi-container-projects/docker-compose","prevSlug":"/lessons/docker-features/dev-containers"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"docker-features","slug":"networking-with-docker"},"buildId":"nARcRKX1ZlcrYUdSUSS9z","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>