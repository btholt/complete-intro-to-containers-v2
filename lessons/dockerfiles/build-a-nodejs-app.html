<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/x-icon" href="/images/favicon.ico"/><title>Build a Node.js App – Complete Intro to Containers</title><meta name="description" content="Learn how to set up a basic Node.js application inside Docker with detailed steps on copying files, exposing ports, and user permissions. Enhance your Dockerfile skills by optimizing file structures and using instructions like COPY, USER, and WORKDIR effectively."/><meta name="keywords" content="Dockerfile,Node.js application,Docker setup,copy files in Docker,expose ports in Docker,user permissions in Docker,WORKDIR instruction"/><meta name="og:description" content="Learn how to set up a basic Node.js application inside Docker with detailed steps on copying files, exposing ports, and user permissions. Enhance your Dockerfile skills by optimizing file structures and using instructions like COPY, USER, and WORKDIR effectively."/><meta name="og:title" content="Build a Node.js App – Complete Intro to Containers"/><meta name="og:image" content="/images/social-share-cover.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="next-head-count" content="14"/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/cfac17cb37b27821.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/cfac17cb37b27821.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-4e7214a60fad8e88.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-5429a50ba5373c56.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-d2ba44903cd47711.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-564cf6bb10408614.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-ba225542c35827e2.js" defer="" crossorigin=""></script><script src="/_next/static/nARcRKX1ZlcrYUdSUSS9z/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/nARcRKX1ZlcrYUdSUSS9z/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Complete Intro to Containers</a></h1><div class="navbar-info"><a href="https://holt.fyi/containers" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><p>So now let&#39;s dig into some more advance things you can do with a Dockerfile. Let&#39;s first make our project a real Node.js application. Make a file called <code>index.js</code> and put this in there.</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);

http
  .<span class="hljs-title function_">createServer</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;request received&quot;</span>);
    response.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;omg hi&quot;</span>, <span class="hljs-string">&quot;utf-8&quot;</span>);
  })
  .<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;server started&quot;</span>);
</code></pre><p><a href="https://github.com/btholt/project-files-for-complete-intro-to-containers-v2/blob/main/build-a-nodejs-app/index.js">⛓️ Link to Node.js file</a></p>
<p>This more-or-less that most barebones Node.js app you can write. It just responds to HTTP traffic on port 3000. Go ahead and try running it on your local computer (outside of Docker) by running <code>node index.js</code>. Open <a href="http://localhost:3000">localhost:3000</a> in your browser to give it a shot.</p>
<p>Okay, so let&#39;s get this running <em>inside</em> Docker now. First thing is we have to copy this file from your local file system into the container. We&#39;ll use a new instruction, <code>COPY</code>. Modify your Dockerfile to say:</p>
<pre><code class="hljs language-dockerfile"><span class="hljs-keyword">FROM</span> node:<span class="hljs-number">20</span>

<span class="hljs-keyword">COPY</span><span class="language-bash"> index.js index.js</span>

<span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;node&quot;</span>, <span class="hljs-string">&quot;index.js&quot;</span>]</span>
</code></pre><p><a href="https://github.com/btholt/project-files-for-complete-intro-to-containers-v2/blob/main/build-a-nodejs-app/Dockerfile">⛓️ Link to Dockerfile</a></p>
<p>This will copy your index.js file from your file system into the Docker file system (the first index.js is the source and the second index.js is the destination of that file inside the container.)</p>
<p>We then modified the <code>CMD</code> to start the server when we finally do run the container. Now run</p>
<pre><code class="hljs language-bash">docker build -t my-node-app .
docker run --name my-app --<span class="hljs-built_in">rm</span> my-node-app
</code></pre><p>You might need to open another terminal and type <code>docker kill my-app</code>.</p>
<p>Now your Node.js app is running inside of a container managed by Docker! Hooray! But one problem, how do we access it? If you open <a href="http://localhost:3000">locahlost:3000</a> now, it doesn&#39;t work! We have to tell Docker to expose the port. So let&#39;s do that now. Stop your container from running and run it again like this.</p>
<p>Try stopping your server now. Your normal CTRL+C won&#39;t work. Node.js itself doesn&#39;t handle SIGINT (which is what CTRL+C is) in and of itself. Instead you either have to handle it yourself inside of your Node.js code (preferable for real apps) or you can tell Docker to handle it with the <code>--init</code> flag. This uses a package called <a href="https://github.com/krallin/tini">tini</a> to handle shutdown signal for you.</p>
<pre><code class="hljs language-bash">docker run --init --publish 3000:3000 --<span class="hljs-built_in">rm</span> my-node-app <span class="hljs-comment"># or you can use -p instead of --publish</span>
</code></pre><p>The <code>publish</code> part allows you to forward a port out of a container to the host computer. In this case we&#39;re forwarding the port of <code>3000</code> (which is what the Node.js server was listening on) to port <code>3000</code> on the host machine. The <code>3000</code> represents the port on the host machine and the second <code>3000</code> represents what port is being used in the container. If you did <code>docker run --publish 8000:3000 my-node-app</code>, you&#39;d open <code>localhost:8000</code> to see the server (running on port <code>3000</code> inside the container).</p>
<p>Next, let&#39;s organize ourselves a bit better. Right now we&#39;re putting our app into the root directory of our container and running it as the root user. This both messy and unsafe. If there&#39;s an exploit for Node.js that get released, it means that whoever uses that exploit on our Node.js server will doing so as root which means they can do whatever they want. Ungood. So let&#39;s fix that. We&#39;ll put the directory inside our home directory under a different users.</p>
<pre><code class="hljs language-dockerfile"><span class="hljs-keyword">FROM</span> node:<span class="hljs-number">20</span>

<span class="hljs-keyword">USER</span> node

<span class="hljs-keyword">COPY</span><span class="language-bash"> index.js /home/node/code/index.js</span>

<span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;node&quot;</span>, <span class="hljs-string">&quot;/home/node/code/index.js&quot;</span>]</span>
</code></pre><p>The <code>USER</code> instruction let&#39;s us switch from being the root user to a different user, one called &quot;node&quot; which the <code>node:20</code> image has already made for us. We could make our own user too using bash commands but let&#39;s just use the one the node image gave us. (More or less you&#39;d run <code>RUN useradd -ms /bin/bash lolcat</code> to add a lolcat user.)</p>
<p>Notice we&#39;re now copying inside of the user&#39;s home directory. This is because they&#39;ll have proper permissions to interact with those files whereas they may not if we were outside of their home directory. You&#39;ll save yourself a lot of permission wrangling if you put it in a home directory. But we&#39;ll have to add a flag to the <code>COPY</code> command to make sure the user owns those files. We&#39;ll do that with <code>--chown=node:node</code> where the first <code>node</code> is the user and the second <code>node</code> is the user group.</p>
<p>It&#39;s no big deal that the &quot;code&quot; directory doesn&#39;t exist, <code>COPY</code> will create it.</p>
<h3>A Quick Note on COPY vs ADD</h3>
<p>The two commands <code>COPY</code> and <code>ADD</code> do very similar things with a few key differences. <code>ADD</code> can also accept, in addition to local files, URLs to download things off the Internet and it will also automatically unzip any tar files it downloads or adds. <code>COPY</code> will just copy local files. Use <code>COPY</code> unless you need to unzip something or are downloading something.</p>
<hr>
<p>Great. Let&#39;s make everything a bit more succint by setting a working directory</p>
<pre><code class="hljs language-dockerfile"><span class="hljs-keyword">FROM</span> node:<span class="hljs-number">20</span>

<span class="hljs-keyword">USER</span> node

<span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /home/node/code</span>

<span class="hljs-keyword">COPY</span><span class="language-bash"> --<span class="hljs-built_in">chown</span>=node:node index.js .</span>

<span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;node&quot;</span>, <span class="hljs-string">&quot;index.js&quot;</span>]</span>
</code></pre><p><a href="https://github.com/btholt/project-files-for-complete-intro-to-containers-v2/blob/main/build-a-nodejs-app/better.Dockerfile">⛓️ Link to Dockerfile</a></p>
<p><code>WORKDIR</code> works as if you had <code>cd</code>&#39;d into that directory, so now all paths are relative to that. And again, if it doesn&#39;t exist, it will create it for you.</p>
<p>Now we just tell <code>COPY</code> to copy the file into the same directory. Now we&#39;re giving it a directory instead of a file name, it&#39;ll just assume we want the same name. You could rename it here if you wanted.</p>
</div><div class="lesson-links"><a href="/lessons/dockerfiles/intro-to-dockerfiles" class="prev">← Previous</a><a href="/lessons/dockerfiles/build-a-more-complicated-nodejs-app" class="next">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="40" height="32" viewBox="0 0 40 32"><defs><clipPath id="clip-twitter-social"><rect width="40" height="32"></rect></clipPath></defs><g id="twitter-social" clip-path="url(#clip-twitter-social)"><g id="Group_269" data-name="Group 269" transform="translate(-230.23 -1140.849)"><path id="Path_419" data-name="Path 419" d="M266.12,1148.861v1.035a23.092,23.092,0,0,1-1.507,8.1,24.08,24.08,0,0,1-4.475,7.381,22.175,22.175,0,0,1-7.306,5.4,24.129,24.129,0,0,1-10,2.07,23.7,23.7,0,0,1-6.667-.945,22.83,22.83,0,0,1-5.936-2.655q.959.091,1.963.09a16.518,16.518,0,0,0,5.434-.9,17.111,17.111,0,0,0,4.749-2.52,8.275,8.275,0,0,1-4.749-1.643,7.8,7.8,0,0,1-2.877-3.983,8.268,8.268,0,0,0,1.507.135,8.58,8.58,0,0,0,2.146-.27,8.16,8.16,0,0,1-5.685-4.344,8.326,8.326,0,0,1-.89-3.578v-.135a7.775,7.775,0,0,0,3.744,1.035,8.183,8.183,0,0,1-2.671-2.9,7.817,7.817,0,0,1-.982-3.848,7.948,7.948,0,0,1,1.1-4.05,23.53,23.53,0,0,0,16.895,8.46,9.221,9.221,0,0,1-.183-1.845,7.787,7.787,0,0,1,1.1-4.05,8.216,8.216,0,0,1,2.991-2.948,7.991,7.991,0,0,1,4.087-1.1,8.184,8.184,0,0,1,5.982,2.566,16.087,16.087,0,0,0,5.205-1.98,7.784,7.784,0,0,1-1.393,2.588,8.4,8.4,0,0,1-2.215,1.913,16.856,16.856,0,0,0,4.749-1.305A17.032,17.032,0,0,1,266.12,1148.861Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Excercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul></footer></div><script async="" defer="" src="https://a.holt.courses/latest.js"></script><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"post":{"attributes":{"title":"Build a Node.js App","description":"Learn how to set up a basic Node.js application inside Docker with detailed steps on copying files, exposing ports, and user permissions. Enhance your Dockerfile skills by optimizing file structures and using instructions like COPY, USER, and WORKDIR effectively.","keywords":["Dockerfile","Node.js application","Docker setup","copy files in Docker","expose ports in Docker","user permissions in Docker","WORKDIR instruction"]},"html":"\u003cp\u003eSo now let\u0026#39;s dig into some more advance things you can do with a Dockerfile. Let\u0026#39;s first make our project a real Node.js application. Make a file called \u003ccode\u003eindex.js\u003c/code\u003e and put this in there.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e http = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;http\u0026quot;\u003c/span\u003e);\n\nhttp\n  .\u003cspan class=\"hljs-title function_\"\u003ecreateServer\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003erequest, response\u003c/span\u003e) {\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;request received\u0026quot;\u003c/span\u003e);\n    response.\u003cspan class=\"hljs-title function_\"\u003eend\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;omg hi\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;utf-8\u0026quot;\u003c/span\u003e);\n  })\n  .\u003cspan class=\"hljs-title function_\"\u003elisten\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e);\n\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;server started\u0026quot;\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca href=\"https://github.com/btholt/project-files-for-complete-intro-to-containers-v2/blob/main/build-a-nodejs-app/index.js\"\u003e⛓️ Link to Node.js file\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThis more-or-less that most barebones Node.js app you can write. It just responds to HTTP traffic on port 3000. Go ahead and try running it on your local computer (outside of Docker) by running \u003ccode\u003enode index.js\u003c/code\u003e. Open \u003ca href=\"http://localhost:3000\"\u003elocalhost:3000\u003c/a\u003e in your browser to give it a shot.\u003c/p\u003e\n\u003cp\u003eOkay, so let\u0026#39;s get this running \u003cem\u003einside\u003c/em\u003e Docker now. First thing is we have to copy this file from your local file system into the container. We\u0026#39;ll use a new instruction, \u003ccode\u003eCOPY\u003c/code\u003e. Modify your Dockerfile to say:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-dockerfile\"\u003e\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e node:\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e index.js index.js\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eCMD\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e [\u003cspan class=\"hljs-string\"\u003e\u0026quot;node\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;index.js\u0026quot;\u003c/span\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca href=\"https://github.com/btholt/project-files-for-complete-intro-to-containers-v2/blob/main/build-a-nodejs-app/Dockerfile\"\u003e⛓️ Link to Dockerfile\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThis will copy your index.js file from your file system into the Docker file system (the first index.js is the source and the second index.js is the destination of that file inside the container.)\u003c/p\u003e\n\u003cp\u003eWe then modified the \u003ccode\u003eCMD\u003c/code\u003e to start the server when we finally do run the container. Now run\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003edocker build -t my-node-app .\ndocker run --name my-app --\u003cspan class=\"hljs-built_in\"\u003erm\u003c/span\u003e my-node-app\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eYou might need to open another terminal and type \u003ccode\u003edocker kill my-app\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eNow your Node.js app is running inside of a container managed by Docker! Hooray! But one problem, how do we access it? If you open \u003ca href=\"http://localhost:3000\"\u003elocahlost:3000\u003c/a\u003e now, it doesn\u0026#39;t work! We have to tell Docker to expose the port. So let\u0026#39;s do that now. Stop your container from running and run it again like this.\u003c/p\u003e\n\u003cp\u003eTry stopping your server now. Your normal CTRL+C won\u0026#39;t work. Node.js itself doesn\u0026#39;t handle SIGINT (which is what CTRL+C is) in and of itself. Instead you either have to handle it yourself inside of your Node.js code (preferable for real apps) or you can tell Docker to handle it with the \u003ccode\u003e--init\u003c/code\u003e flag. This uses a package called \u003ca href=\"https://github.com/krallin/tini\"\u003etini\u003c/a\u003e to handle shutdown signal for you.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003edocker run --init --publish 3000:3000 --\u003cspan class=\"hljs-built_in\"\u003erm\u003c/span\u003e my-node-app \u003cspan class=\"hljs-comment\"\u003e# or you can use -p instead of --publish\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThe \u003ccode\u003epublish\u003c/code\u003e part allows you to forward a port out of a container to the host computer. In this case we\u0026#39;re forwarding the port of \u003ccode\u003e3000\u003c/code\u003e (which is what the Node.js server was listening on) to port \u003ccode\u003e3000\u003c/code\u003e on the host machine. The \u003ccode\u003e3000\u003c/code\u003e represents the port on the host machine and the second \u003ccode\u003e3000\u003c/code\u003e represents what port is being used in the container. If you did \u003ccode\u003edocker run --publish 8000:3000 my-node-app\u003c/code\u003e, you\u0026#39;d open \u003ccode\u003elocalhost:8000\u003c/code\u003e to see the server (running on port \u003ccode\u003e3000\u003c/code\u003e inside the container).\u003c/p\u003e\n\u003cp\u003eNext, let\u0026#39;s organize ourselves a bit better. Right now we\u0026#39;re putting our app into the root directory of our container and running it as the root user. This both messy and unsafe. If there\u0026#39;s an exploit for Node.js that get released, it means that whoever uses that exploit on our Node.js server will doing so as root which means they can do whatever they want. Ungood. So let\u0026#39;s fix that. We\u0026#39;ll put the directory inside our home directory under a different users.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-dockerfile\"\u003e\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e node:\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eUSER\u003c/span\u003e node\n\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e index.js /home/node/code/index.js\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eCMD\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e [\u003cspan class=\"hljs-string\"\u003e\u0026quot;node\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;/home/node/code/index.js\u0026quot;\u003c/span\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThe \u003ccode\u003eUSER\u003c/code\u003e instruction let\u0026#39;s us switch from being the root user to a different user, one called \u0026quot;node\u0026quot; which the \u003ccode\u003enode:20\u003c/code\u003e image has already made for us. We could make our own user too using bash commands but let\u0026#39;s just use the one the node image gave us. (More or less you\u0026#39;d run \u003ccode\u003eRUN useradd -ms /bin/bash lolcat\u003c/code\u003e to add a lolcat user.)\u003c/p\u003e\n\u003cp\u003eNotice we\u0026#39;re now copying inside of the user\u0026#39;s home directory. This is because they\u0026#39;ll have proper permissions to interact with those files whereas they may not if we were outside of their home directory. You\u0026#39;ll save yourself a lot of permission wrangling if you put it in a home directory. But we\u0026#39;ll have to add a flag to the \u003ccode\u003eCOPY\u003c/code\u003e command to make sure the user owns those files. We\u0026#39;ll do that with \u003ccode\u003e--chown=node:node\u003c/code\u003e where the first \u003ccode\u003enode\u003c/code\u003e is the user and the second \u003ccode\u003enode\u003c/code\u003e is the user group.\u003c/p\u003e\n\u003cp\u003eIt\u0026#39;s no big deal that the \u0026quot;code\u0026quot; directory doesn\u0026#39;t exist, \u003ccode\u003eCOPY\u003c/code\u003e will create it.\u003c/p\u003e\n\u003ch3\u003eA Quick Note on COPY vs ADD\u003c/h3\u003e\n\u003cp\u003eThe two commands \u003ccode\u003eCOPY\u003c/code\u003e and \u003ccode\u003eADD\u003c/code\u003e do very similar things with a few key differences. \u003ccode\u003eADD\u003c/code\u003e can also accept, in addition to local files, URLs to download things off the Internet and it will also automatically unzip any tar files it downloads or adds. \u003ccode\u003eCOPY\u003c/code\u003e will just copy local files. Use \u003ccode\u003eCOPY\u003c/code\u003e unless you need to unzip something or are downloading something.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eGreat. Let\u0026#39;s make everything a bit more succint by setting a working directory\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-dockerfile\"\u003e\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e node:\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eUSER\u003c/span\u003e node\n\n\u003cspan class=\"hljs-keyword\"\u003eWORKDIR\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e /home/node/code\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e --\u003cspan class=\"hljs-built_in\"\u003echown\u003c/span\u003e=node:node index.js .\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eCMD\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e [\u003cspan class=\"hljs-string\"\u003e\u0026quot;node\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;index.js\u0026quot;\u003c/span\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca href=\"https://github.com/btholt/project-files-for-complete-intro-to-containers-v2/blob/main/build-a-nodejs-app/better.Dockerfile\"\u003e⛓️ Link to Dockerfile\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eWORKDIR\u003c/code\u003e works as if you had \u003ccode\u003ecd\u003c/code\u003e\u0026#39;d into that directory, so now all paths are relative to that. And again, if it doesn\u0026#39;t exist, it will create it for you.\u003c/p\u003e\n\u003cp\u003eNow we just tell \u003ccode\u003eCOPY\u003c/code\u003e to copy the file into the same directory. Now we\u0026#39;re giving it a directory instead of a file name, it\u0026#39;ll just assume we want the same name. You could rename it here if you wanted.\u003c/p\u003e\n","markdown":"\nSo now let's dig into some more advance things you can do with a Dockerfile. Let's first make our project a real Node.js application. Make a file called `index.js` and put this in there.\n\n```javascript\nconst http = require(\"http\");\n\nhttp\n  .createServer(function (request, response) {\n    console.log(\"request received\");\n    response.end(\"omg hi\", \"utf-8\");\n  })\n  .listen(3000);\nconsole.log(\"server started\");\n```\n\n[⛓️ Link to Node.js file][node-file]\n\nThis more-or-less that most barebones Node.js app you can write. It just responds to HTTP traffic on port 3000. Go ahead and try running it on your local computer (outside of Docker) by running `node index.js`. Open [localhost:3000][localhost] in your browser to give it a shot.\n\nOkay, so let's get this running _inside_ Docker now. First thing is we have to copy this file from your local file system into the container. We'll use a new instruction, `COPY`. Modify your Dockerfile to say:\n\n```dockerfile\nFROM node:20\n\nCOPY index.js index.js\n\nCMD [\"node\", \"index.js\"]\n```\n\n[⛓️ Link to Dockerfile][dockerfile-1]\n\nThis will copy your index.js file from your file system into the Docker file system (the first index.js is the source and the second index.js is the destination of that file inside the container.)\n\nWe then modified the `CMD` to start the server when we finally do run the container. Now run\n\n```bash\ndocker build -t my-node-app .\ndocker run --name my-app --rm my-node-app\n```\n\nYou might need to open another terminal and type `docker kill my-app`.\n\nNow your Node.js app is running inside of a container managed by Docker! Hooray! But one problem, how do we access it? If you open [locahlost:3000][localhost] now, it doesn't work! We have to tell Docker to expose the port. So let's do that now. Stop your container from running and run it again like this.\n\nTry stopping your server now. Your normal CTRL+C won't work. Node.js itself doesn't handle SIGINT (which is what CTRL+C is) in and of itself. Instead you either have to handle it yourself inside of your Node.js code (preferable for real apps) or you can tell Docker to handle it with the `--init` flag. This uses a package called [tini][tini] to handle shutdown signal for you.\n\n```bash\ndocker run --init --publish 3000:3000 --rm my-node-app # or you can use -p instead of --publish\n```\n\nThe `publish` part allows you to forward a port out of a container to the host computer. In this case we're forwarding the port of `3000` (which is what the Node.js server was listening on) to port `3000` on the host machine. The `3000` represents the port on the host machine and the second `3000` represents what port is being used in the container. If you did `docker run --publish 8000:3000 my-node-app`, you'd open `localhost:8000` to see the server (running on port `3000` inside the container).\n\nNext, let's organize ourselves a bit better. Right now we're putting our app into the root directory of our container and running it as the root user. This both messy and unsafe. If there's an exploit for Node.js that get released, it means that whoever uses that exploit on our Node.js server will doing so as root which means they can do whatever they want. Ungood. So let's fix that. We'll put the directory inside our home directory under a different users.\n\n```dockerfile\nFROM node:20\n\nUSER node\n\nCOPY index.js /home/node/code/index.js\n\nCMD [\"node\", \"/home/node/code/index.js\"]\n```\n\nThe `USER` instruction let's us switch from being the root user to a different user, one called \"node\" which the `node:20` image has already made for us. We could make our own user too using bash commands but let's just use the one the node image gave us. (More or less you'd run `RUN useradd -ms /bin/bash lolcat` to add a lolcat user.)\n\nNotice we're now copying inside of the user's home directory. This is because they'll have proper permissions to interact with those files whereas they may not if we were outside of their home directory. You'll save yourself a lot of permission wrangling if you put it in a home directory. But we'll have to add a flag to the `COPY` command to make sure the user owns those files. We'll do that with `--chown=node:node` where the first `node` is the user and the second `node` is the user group.\n\nIt's no big deal that the \"code\" directory doesn't exist, `COPY` will create it.\n\n### A Quick Note on COPY vs ADD\n\nThe two commands `COPY` and `ADD` do very similar things with a few key differences. `ADD` can also accept, in addition to local files, URLs to download things off the Internet and it will also automatically unzip any tar files it downloads or adds. `COPY` will just copy local files. Use `COPY` unless you need to unzip something or are downloading something.\n\n---\n\nGreat. Let's make everything a bit more succint by setting a working directory\n\n```dockerfile\nFROM node:20\n\nUSER node\n\nWORKDIR /home/node/code\n\nCOPY --chown=node:node index.js .\n\nCMD [\"node\", \"index.js\"]\n```\n\n[⛓️ Link to Dockerfile][dockerfile-2]\n\n`WORKDIR` works as if you had `cd`'d into that directory, so now all paths are relative to that. And again, if it doesn't exist, it will create it for you.\n\nNow we just tell `COPY` to copy the file into the same directory. Now we're giving it a directory instead of a file name, it'll just assume we want the same name. You could rename it here if you wanted.\n\n[localhost]: http://localhost:3000\n[tini]: https://github.com/krallin/tini\n[node-file]: https://github.com/btholt/project-files-for-complete-intro-to-containers-v2/blob/main/build-a-nodejs-app/index.js\n[dockerfile-1]: https://github.com/btholt/project-files-for-complete-intro-to-containers-v2/blob/main/build-a-nodejs-app/Dockerfile\n[dockerfile-2]: https://github.com/btholt/project-files-for-complete-intro-to-containers-v2/blob/main/build-a-nodejs-app/better.Dockerfile\n","slug":"build-a-nodejs-app","title":"Build a Node.js App","section":"Dockerfiles","icon":"file-lines","filePath":"/home/runner/work/complete-intro-to-containers-v2/complete-intro-to-containers-v2/lessons/04-dockerfiles/B-build-a-nodejs-app.md","nextSlug":"/lessons/dockerfiles/build-a-more-complicated-nodejs-app","prevSlug":"/lessons/dockerfiles/intro-to-dockerfiles"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"dockerfiles","slug":"build-a-nodejs-app"},"buildId":"nARcRKX1ZlcrYUdSUSS9z","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>