<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/x-icon" href="/images/favicon.ico"/><title>Kompose – Complete Intro to Containers</title><meta name="description" content="Learn how to use Kompose to convert a docker-compose.yml configuration to Kubernetes, scale services using Kubernetes, set up LoadBalancer for exposing services, and interact with Kubernetes cluster using kubectl. Explore deployment options on Azure AKS, Amazon EKS, and Google GKE."/><meta name="keywords" content="Kompose,Kubernetes scaling,LoadBalancer,kubectl,Azure AKS,Amazon EKS,Google GKE"/><meta name="og:description" content="Learn how to use Kompose to convert a docker-compose.yml configuration to Kubernetes, scale services using Kubernetes, set up LoadBalancer for exposing services, and interact with Kubernetes cluster using kubectl. Explore deployment options on Azure AKS, Amazon EKS, and Google GKE."/><meta name="og:title" content="Kompose – Complete Intro to Containers"/><meta name="og:image" content="/images/social-share-cover.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="next-head-count" content="14"/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/cfac17cb37b27821.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/cfac17cb37b27821.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-4e7214a60fad8e88.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-5429a50ba5373c56.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-d2ba44903cd47711.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-564cf6bb10408614.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-ba225542c35827e2.js" defer="" crossorigin=""></script><script src="/_next/static/nARcRKX1ZlcrYUdSUSS9z/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/nARcRKX1ZlcrYUdSUSS9z/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Complete Intro to Containers</a></h1><div class="navbar-info"><a href="https://holt.fyi/containers" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><p>Next tool we&#39;re going to use is one called <a href="https://kompose.io/">Kompose</a>. I&#39;m showing you this tool because it&#39;s how I start out with Kubernetes when I have a project that I want to use with it. Kompose converts a docker-compose.yml configuration to a Kubernetes configuration. I find this to much more approachable than starting with the myriad configurations you need to get Kubernetes going.</p>
<p><a href="https://kompose.io/installation/">Click here</a> to see how to install Kompose on your platform. I did <code>brew install kompose</code> with Homebrew.</p>
<p>So first let&#39;s modify our docker-compose.yml a bit to make it work for Kompose.</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">services:</span>
  <span class="hljs-attr">api:</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">api</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8080:8080&quot;</span>
    <span class="hljs-attr">links:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">db</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">db</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">MONGO_CONNECTION_STRING:</span> <span class="hljs-string">mongodb://db:27017</span>
    <span class="hljs-attr">labels:</span>
      <span class="hljs-attr">kompose.service.type:</span> <span class="hljs-string">nodeport</span>
      <span class="hljs-attr">kompose.image-pull-policy:</span> <span class="hljs-string">Never</span>
  <span class="hljs-attr">db:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">mongo:7</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;27017:27017&quot;</span>
  <span class="hljs-attr">web:</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">web</span>
    <span class="hljs-attr">links:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">api</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">api</span>
    <span class="hljs-attr">labels:</span>
      <span class="hljs-attr">kompose.service.type:</span> <span class="hljs-string">LoadBalancer</span>
      <span class="hljs-attr">kompose.service.expose:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">kompose.image-pull-policy:</span> <span class="hljs-string">Never</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8081:80&quot;</span>
</code></pre><p><a href="https://github.com/btholt/project-files-for-complete-intro-to-containers-v2/blob/main/kubernetes">⛓️ Link to the project</a></p>
<blockquote>
<p>I went ahead here and modified the NGINX config to handle all inbound traffic. We could expose two services but in reality we want NGINX to be our front door and then allow our API to scale independently. I also modified the Node.js app to have correct paths relative to NGINX routes.</p>
</blockquote>
<p>We add the <code>NodePort</code> type to the api service so that we can scale this part of our infra up and Kubernetes will make it bind to different ports. Any app can reach api on 8080 but we can have 50 scaled up instances that it&#39;s spreading across.</p>
<p>We add the <code>LoadBalancer</code> label to web so that Kubernetes will know to expose this particular service to the outside world. What this actually does for you is it spins up a loadbalancer that will distribute the load amongst all of your running pods. Do note tha this one of three ways to expose a service to outside world (by default everything is only expose internally). The other two are NodePort and using an ingress controller. <a href="https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0">This is a great explainer</a> if you&#39;re curious. For now LoadBalancer is perfect. It&#39;s actually just a NodePort under the hood in Kubernetes but once you deploy to GCP, AWS, or Azure they&#39;ll use their own flavor of load balancer for you. You can also handle this yourself but that&#39;s <em>way</em> outside the scope of this course.</p>
<p>Lastly, we need to explicit about the port MongoDB exposes. Locally Docker was able to take care of it but Kubernetes needs us to be super explicity of what&#39;s exposed and what&#39;s not.</p>
<blockquote>
<p>They used to let you do <code>kompose up</code> but now they don&#39;t. You have to convert the config and then apply the configs.</p>
</blockquote>
<pre><code class="hljs language-bash">kompose convert --build <span class="hljs-built_in">local</span>
</code></pre><p>Okay, now that you&#39;ve done this, run</p>
<pre><code class="hljs language-bash">kubectl apply -f <span class="hljs-string">&#x27;*.yaml&#x27;</span>
</code></pre><blockquote>
<p>If you see an error, make sure you have the quotes, they&#39;re needed, and make sure that your docker-compose.yml file doesn&#39;t have .yaml for its extension.</p>
</blockquote>
<p>To get a bird&#39;s eye view of everything running, run <code>kubectl get all</code> to see everything happening. Critically, we want to see STATUS: Running on all three of our services. If you&#39;re seeing something like ErrImagePull or something like that, it means your containers probably aren&#39;t pulling locally and you&#39;ll need to debug that.</p>
<p>Let&#39;s do some Kubernetes magic now. Run <code>kubectl scale --replicas=5 deployment/api</code> and run <code>kubectl get all</code>. Just like that, you have five instances of our Node.js app running and Kubernetes smartly routing traffic to each. If one of them becomes unhealthy, Kubernetes will automatically tear it down and spin up a new one. By setting up Kubernetes, you get a lot of cool stuff for free. If you&#39;re computer is starting to warm up, feel free to run <code>kubectl scale --replicas=1 deployment/api</code> to scale down. You can scale the database the same way too but the loadbalancer won&#39;t do it but again that&#39;s because Kubernetes expects the cloud provider to do that for you.</p>
<p>Once you&#39;re done toying, run <code>kubectl delete all --all</code>. This will tear down everything.</p>
<h2>To the cloud!</h2>
<p>What&#39;s super fun is that kubectl is the same tool you&#39;d use to control your production deployment. So everything you just learn would work against Azure, AWS, GCP, etc. All you have to do is change the context from minikube or docker-desktop to Azure, AWS, or GCP. I&#39;m not going to do that but I&#39;ll drop the tutorials here so you can play around yourself. Do note these are often not free and if you&#39;re not careful, Kubernetes can get expensive!</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/aks/kubernetes-walkthrough">Azure AKS</a></li>
<li><a href="https://docs.aws.amazon.com/eks/latest/userguide/getting-started.html">Amazon EKS</a></li>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/quickstart">Google GKE</a></li>
</ul>
</div><div class="lesson-links"><a href="/lessons/multi-container-projects/kubernetes" class="prev">← Previous</a><a href="/lessons/wrap-up/docker-alternatives" class="next">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="40" height="32" viewBox="0 0 40 32"><defs><clipPath id="clip-twitter-social"><rect width="40" height="32"></rect></clipPath></defs><g id="twitter-social" clip-path="url(#clip-twitter-social)"><g id="Group_269" data-name="Group 269" transform="translate(-230.23 -1140.849)"><path id="Path_419" data-name="Path 419" d="M266.12,1148.861v1.035a23.092,23.092,0,0,1-1.507,8.1,24.08,24.08,0,0,1-4.475,7.381,22.175,22.175,0,0,1-7.306,5.4,24.129,24.129,0,0,1-10,2.07,23.7,23.7,0,0,1-6.667-.945,22.83,22.83,0,0,1-5.936-2.655q.959.091,1.963.09a16.518,16.518,0,0,0,5.434-.9,17.111,17.111,0,0,0,4.749-2.52,8.275,8.275,0,0,1-4.749-1.643,7.8,7.8,0,0,1-2.877-3.983,8.268,8.268,0,0,0,1.507.135,8.58,8.58,0,0,0,2.146-.27,8.16,8.16,0,0,1-5.685-4.344,8.326,8.326,0,0,1-.89-3.578v-.135a7.775,7.775,0,0,0,3.744,1.035,8.183,8.183,0,0,1-2.671-2.9,7.817,7.817,0,0,1-.982-3.848,7.948,7.948,0,0,1,1.1-4.05,23.53,23.53,0,0,0,16.895,8.46,9.221,9.221,0,0,1-.183-1.845,7.787,7.787,0,0,1,1.1-4.05,8.216,8.216,0,0,1,2.991-2.948,7.991,7.991,0,0,1,4.087-1.1,8.184,8.184,0,0,1,5.982,2.566,16.087,16.087,0,0,0,5.205-1.98,7.784,7.784,0,0,1-1.393,2.588,8.4,8.4,0,0,1-2.215,1.913,16.856,16.856,0,0,0,4.749-1.305A17.032,17.032,0,0,1,266.12,1148.861Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Excercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul></footer></div><script async="" defer="" src="https://a.holt.courses/latest.js"></script><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"post":{"attributes":{"description":"Learn how to use Kompose to convert a docker-compose.yml configuration to Kubernetes, scale services using Kubernetes, set up LoadBalancer for exposing services, and interact with Kubernetes cluster using kubectl. Explore deployment options on Azure AKS, Amazon EKS, and Google GKE.","keywords":["Kompose","Kubernetes scaling","LoadBalancer","kubectl","Azure AKS","Amazon EKS","Google GKE"]},"html":"\u003cp\u003eNext tool we\u0026#39;re going to use is one called \u003ca href=\"https://kompose.io/\"\u003eKompose\u003c/a\u003e. I\u0026#39;m showing you this tool because it\u0026#39;s how I start out with Kubernetes when I have a project that I want to use with it. Kompose converts a docker-compose.yml configuration to a Kubernetes configuration. I find this to much more approachable than starting with the myriad configurations you need to get Kubernetes going.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://kompose.io/installation/\"\u003eClick here\u003c/a\u003e to see how to install Kompose on your platform. I did \u003ccode\u003ebrew install kompose\u003c/code\u003e with Homebrew.\u003c/p\u003e\n\u003cp\u003eSo first let\u0026#39;s modify our docker-compose.yml a bit to make it work for Kompose.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003eservices:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eapi:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ebuild:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eapi\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eports:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;8080:8080\u0026quot;\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003elinks:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edb\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003edepends_on:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edb\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eenvironment:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eMONGO_CONNECTION_STRING:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emongodb://db:27017\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003elabels:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003ekompose.service.type:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enodeport\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003ekompose.image-pull-policy:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eNever\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003edb:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emongo:7\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eports:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;27017:27017\u0026quot;\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eweb:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ebuild:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eweb\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003elinks:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eapi\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003edepends_on:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eapi\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003elabels:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003ekompose.service.type:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eLoadBalancer\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003ekompose.service.expose:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003ekompose.image-pull-policy:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eNever\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eports:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;8081:80\u0026quot;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ca href=\"https://github.com/btholt/project-files-for-complete-intro-to-containers-v2/blob/main/kubernetes\"\u003e⛓️ Link to the project\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eI went ahead here and modified the NGINX config to handle all inbound traffic. We could expose two services but in reality we want NGINX to be our front door and then allow our API to scale independently. I also modified the Node.js app to have correct paths relative to NGINX routes.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eWe add the \u003ccode\u003eNodePort\u003c/code\u003e type to the api service so that we can scale this part of our infra up and Kubernetes will make it bind to different ports. Any app can reach api on 8080 but we can have 50 scaled up instances that it\u0026#39;s spreading across.\u003c/p\u003e\n\u003cp\u003eWe add the \u003ccode\u003eLoadBalancer\u003c/code\u003e label to web so that Kubernetes will know to expose this particular service to the outside world. What this actually does for you is it spins up a loadbalancer that will distribute the load amongst all of your running pods. Do note tha this one of three ways to expose a service to outside world (by default everything is only expose internally). The other two are NodePort and using an ingress controller. \u003ca href=\"https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0\"\u003eThis is a great explainer\u003c/a\u003e if you\u0026#39;re curious. For now LoadBalancer is perfect. It\u0026#39;s actually just a NodePort under the hood in Kubernetes but once you deploy to GCP, AWS, or Azure they\u0026#39;ll use their own flavor of load balancer for you. You can also handle this yourself but that\u0026#39;s \u003cem\u003eway\u003c/em\u003e outside the scope of this course.\u003c/p\u003e\n\u003cp\u003eLastly, we need to explicit about the port MongoDB exposes. Locally Docker was able to take care of it but Kubernetes needs us to be super explicity of what\u0026#39;s exposed and what\u0026#39;s not.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThey used to let you do \u003ccode\u003ekompose up\u003c/code\u003e but now they don\u0026#39;t. You have to convert the config and then apply the configs.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ekompose convert --build \u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eOkay, now that you\u0026#39;ve done this, run\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ekubectl apply -f \u003cspan class=\"hljs-string\"\u003e\u0026#x27;*.yaml\u0026#x27;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003eIf you see an error, make sure you have the quotes, they\u0026#39;re needed, and make sure that your docker-compose.yml file doesn\u0026#39;t have .yaml for its extension.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eTo get a bird\u0026#39;s eye view of everything running, run \u003ccode\u003ekubectl get all\u003c/code\u003e to see everything happening. Critically, we want to see STATUS: Running on all three of our services. If you\u0026#39;re seeing something like ErrImagePull or something like that, it means your containers probably aren\u0026#39;t pulling locally and you\u0026#39;ll need to debug that.\u003c/p\u003e\n\u003cp\u003eLet\u0026#39;s do some Kubernetes magic now. Run \u003ccode\u003ekubectl scale --replicas=5 deployment/api\u003c/code\u003e and run \u003ccode\u003ekubectl get all\u003c/code\u003e. Just like that, you have five instances of our Node.js app running and Kubernetes smartly routing traffic to each. If one of them becomes unhealthy, Kubernetes will automatically tear it down and spin up a new one. By setting up Kubernetes, you get a lot of cool stuff for free. If you\u0026#39;re computer is starting to warm up, feel free to run \u003ccode\u003ekubectl scale --replicas=1 deployment/api\u003c/code\u003e to scale down. You can scale the database the same way too but the loadbalancer won\u0026#39;t do it but again that\u0026#39;s because Kubernetes expects the cloud provider to do that for you.\u003c/p\u003e\n\u003cp\u003eOnce you\u0026#39;re done toying, run \u003ccode\u003ekubectl delete all --all\u003c/code\u003e. This will tear down everything.\u003c/p\u003e\n\u003ch2\u003eTo the cloud!\u003c/h2\u003e\n\u003cp\u003eWhat\u0026#39;s super fun is that kubectl is the same tool you\u0026#39;d use to control your production deployment. So everything you just learn would work against Azure, AWS, GCP, etc. All you have to do is change the context from minikube or docker-desktop to Azure, AWS, or GCP. I\u0026#39;m not going to do that but I\u0026#39;ll drop the tutorials here so you can play around yourself. Do note these are often not free and if you\u0026#39;re not careful, Kubernetes can get expensive!\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://docs.microsoft.com/en-us/azure/aks/kubernetes-walkthrough\"\u003eAzure AKS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.aws.amazon.com/eks/latest/userguide/getting-started.html\"\u003eAmazon EKS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://cloud.google.com/kubernetes-engine/docs/quickstart\"\u003eGoogle GKE\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","markdown":"\nNext tool we're going to use is one called [Kompose][kompose]. I'm showing you this tool because it's how I start out with Kubernetes when I have a project that I want to use with it. Kompose converts a docker-compose.yml configuration to a Kubernetes configuration. I find this to much more approachable than starting with the myriad configurations you need to get Kubernetes going.\n\n[Click here][install-kompose] to see how to install Kompose on your platform. I did `brew install kompose` with Homebrew.\n\nSo first let's modify our docker-compose.yml a bit to make it work for Kompose.\n\n```yml\nservices:\n  api:\n    build: api\n    ports:\n      - \"8080:8080\"\n    links:\n      - db\n    depends_on:\n      - db\n    environment:\n      MONGO_CONNECTION_STRING: mongodb://db:27017\n    labels:\n      kompose.service.type: nodeport\n      kompose.image-pull-policy: Never\n  db:\n    image: mongo:7\n    ports:\n      - \"27017:27017\"\n  web:\n    build: web\n    links:\n      - api\n    depends_on:\n      - api\n    labels:\n      kompose.service.type: LoadBalancer\n      kompose.service.expose: true\n      kompose.image-pull-policy: Never\n    ports:\n      - \"8081:80\"\n```\n\n[⛓️ Link to the project][project]\n\n\u003e I went ahead here and modified the NGINX config to handle all inbound traffic. We could expose two services but in reality we want NGINX to be our front door and then allow our API to scale independently. I also modified the Node.js app to have correct paths relative to NGINX routes.\n\nWe add the `NodePort` type to the api service so that we can scale this part of our infra up and Kubernetes will make it bind to different ports. Any app can reach api on 8080 but we can have 50 scaled up instances that it's spreading across.\n\nWe add the `LoadBalancer` label to web so that Kubernetes will know to expose this particular service to the outside world. What this actually does for you is it spins up a loadbalancer that will distribute the load amongst all of your running pods. Do note tha this one of three ways to expose a service to outside world (by default everything is only expose internally). The other two are NodePort and using an ingress controller. [This is a great explainer][ingress] if you're curious. For now LoadBalancer is perfect. It's actually just a NodePort under the hood in Kubernetes but once you deploy to GCP, AWS, or Azure they'll use their own flavor of load balancer for you. You can also handle this yourself but that's _way_ outside the scope of this course.\n\nLastly, we need to explicit about the port MongoDB exposes. Locally Docker was able to take care of it but Kubernetes needs us to be super explicity of what's exposed and what's not.\n\n\u003e They used to let you do `kompose up` but now they don't. You have to convert the config and then apply the configs.\n\n```bash\nkompose convert --build local\n```\n\nOkay, now that you've done this, run\n\n```bash\nkubectl apply -f '*.yaml'\n```\n\n\u003e If you see an error, make sure you have the quotes, they're needed, and make sure that your docker-compose.yml file doesn't have .yaml for its extension.\n\nTo get a bird's eye view of everything running, run `kubectl get all` to see everything happening. Critically, we want to see STATUS: Running on all three of our services. If you're seeing something like ErrImagePull or something like that, it means your containers probably aren't pulling locally and you'll need to debug that.\n\nLet's do some Kubernetes magic now. Run `kubectl scale --replicas=5 deployment/api` and run `kubectl get all`. Just like that, you have five instances of our Node.js app running and Kubernetes smartly routing traffic to each. If one of them becomes unhealthy, Kubernetes will automatically tear it down and spin up a new one. By setting up Kubernetes, you get a lot of cool stuff for free. If you're computer is starting to warm up, feel free to run `kubectl scale --replicas=1 deployment/api` to scale down. You can scale the database the same way too but the loadbalancer won't do it but again that's because Kubernetes expects the cloud provider to do that for you.\n\nOnce you're done toying, run `kubectl delete all --all`. This will tear down everything.\n\n## To the cloud!\n\nWhat's super fun is that kubectl is the same tool you'd use to control your production deployment. So everything you just learn would work against Azure, AWS, GCP, etc. All you have to do is change the context from minikube or docker-desktop to Azure, AWS, or GCP. I'm not going to do that but I'll drop the tutorials here so you can play around yourself. Do note these are often not free and if you're not careful, Kubernetes can get expensive!\n\n- [Azure AKS][aks]\n- [Amazon EKS][aws]\n- [Google GKE][gcp]\n\n[ingress]: https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0\n[localhost]: http://localhost:3000\n[aks]: https://docs.microsoft.com/en-us/azure/aks/kubernetes-walkthrough\n[aws]: https://docs.aws.amazon.com/eks/latest/userguide/getting-started.html\n[gcp]: https://cloud.google.com/kubernetes-engine/docs/quickstart\n[kompose]: https://kompose.io/\n[install-kompose]: https://kompose.io/installation/\n[project]: https://github.com/btholt/project-files-for-complete-intro-to-containers-v2/blob/main/kubernetes\n","slug":"kompose","title":"Kompose","section":"Multi Container Projects","icon":"boxes-stacked","filePath":"/home/runner/work/complete-intro-to-containers-v2/complete-intro-to-containers-v2/lessons/07-multi-container-projects/C-kompose.md","nextSlug":"/lessons/wrap-up/docker-alternatives","prevSlug":"/lessons/multi-container-projects/kubernetes"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"multi-container-projects","slug":"kompose"},"buildId":"nARcRKX1ZlcrYUdSUSS9z","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>