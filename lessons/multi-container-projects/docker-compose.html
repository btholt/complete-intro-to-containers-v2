<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/x-icon" href="/images/favicon.ico"/><title>Docker Compose – Complete Intro to Containers</title><meta name="description" content="Learn how to use Docker Compose to coordinate multiple containers for development environments efficiently. Simplify defining relationships between containers using a YAML file, making it easy to manage complex setups with one command. Explore CI/CD integration possibilities and enhance development productivity by leveraging Docker Compose features."/><meta name="keywords" content="Docker Compose,multiple containers,development environments,CI/CD scenarios,YAML file,containers relationship,productivity"/><meta name="og:description" content="Learn how to use Docker Compose to coordinate multiple containers for development environments efficiently. Simplify defining relationships between containers using a YAML file, making it easy to manage complex setups with one command. Explore CI/CD integration possibilities and enhance development productivity by leveraging Docker Compose features."/><meta name="og:title" content="Docker Compose – Complete Intro to Containers"/><meta name="og:image" content="/images/social-share-cover.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="next-head-count" content="14"/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/cfac17cb37b27821.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/cfac17cb37b27821.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-4e7214a60fad8e88.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-5429a50ba5373c56.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-d2ba44903cd47711.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-564cf6bb10408614.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-ba225542c35827e2.js" defer="" crossorigin=""></script><script src="/_next/static/nARcRKX1ZlcrYUdSUSS9z/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/nARcRKX1ZlcrYUdSUSS9z/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Complete Intro to Containers</a></h1><div class="navbar-info"><a href="https://holt.fyi/containers" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><p>This may be one of the most useful features you learn about Docker. We&#39;ve been mixing various different facets of deploying your app to production and creating development environments. This feature in particular is geared much more for development environments. Many times when you&#39;re developing containers you&#39;re not in just a single container environment (though that does happen too.) When this happens, you need to coordinate multiple containers when you&#39;re doing local dev and you&#39;ve seen in the previous chapter, networking, that it&#39;s possible if a bit annoying.</p>
<p>With Docker Compose we simplify this a lot. Docker Compose allows us the ability to coordinate multiple containers and do so with one YAML file. This is great if you&#39;re developing a Node.js app and it requires a database, caching, or even if you have two+ separate apps in two+ separate containers that depend on each other or all the above! Docker Compose makes it really simple to define the relationship between these containers and get them all running with one <code>docker compose up</code>.</p>
<blockquote>
<p>If you see any commands out there with <code>docker-compose</code> (key being the <code>-</code> in there) it&#39;s from Docker Compose v1 which is not supported anymore. We are using Docker Compose v2 here. For our purposes there isn&#39;t much difference.</p>
</blockquote>
<p>Do note that Docker does say that Docker Compose is suitable for production environments if you have a single instance running multiple containers. This is atypical for the most part: if you have multiple containers, typically you want the ability to have many instances.</p>
<p>In addition to working very well dev, Docker Compose is very useful in CI/CD scenarios when you want GitHub Actions or some CI/CD provider to spin up multiple environments to quickly run some tests.</p>
<p>Okay so let&#39;s get our previous app working: the one with a MongoDB database being connected to by a Node.js app. Create a new file in the root directory of your project called <code>docker-compose.yml</code> and put this in there:</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">services:</span>
  <span class="hljs-attr">api:</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">api</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8080:8080&quot;</span>
    <span class="hljs-attr">links:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">db</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">MONGO_CONNECTION_STRING:</span> <span class="hljs-string">mongodb://db:27017</span>
  <span class="hljs-attr">db:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">mongo:7</span>
  <span class="hljs-attr">web:</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">web</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8081:80&quot;</span>
</code></pre><p>This should feel familiar even if it&#39;s new to you. This is basically all of the CLI configurations we were giving to the two containers but captured in a YAML file.</p>
<p>In <code>service</code> we define the containers we need for this particular app. We have two: the <code>web</code> container (which is our app) and the <code>db</code> container which is MongoDB. We then identify where the Dockerfile is with <code>build</code>, which ports to expose in <code>ports</code>, and the <code>environment</code> variables using that field.</p>
<p>The one interesting one here is the <code>links</code> field. In this one we&#39;re saying that the <code>api</code> container needs to be connected to the <code>db</code> container. This means Docker will start this container first and then network it to the <code>api</code> container. This works the same way as what we were doing in the previous lesson.</p>
<p>The <code>db</code> container is pretty simple: it&#39;s just the <code>mongo</code> container from Docker Hub. This is actually smart enough to expose 27017 as the port and to make a volume to keep the data around between restarts so we don&#39;t actually have to do anything for that. If you needed any other containers, you&#39;d just put them here in services.</p>
<p>We then have a frontend React.js app that is being built by Parcel.js and served by NGINX.</p>
<p>There&#39;s a lot more to compose files than what I&#39;ve shown you here but I&#39;ll let you explore that on your own time. <a href="https://docs.docker.com/compose/compose-file/#compose-file-structure-and-examples">Click here</a> to see the docs to see what else is possible.</p>
<p>This will start and work now, just run <code>docker compose up</code> and it&#39;ll get going. I just want to do one thing: let&#39;s make our app even more productive to develop on. Go to your Dockerfile for the app make it read a such:</p>
<blockquote>
<p>If you change something and want to make sure it builds, make sure to run <code>docker compose up --build</code>. Docker Compose isn&#39;t watching for changes when you run up.</p>
</blockquote>
<pre><code class="hljs language-dockerfile"><span class="hljs-keyword">FROM</span> node:latest

<span class="hljs-keyword">RUN</span><span class="language-bash"> npm i -g nodemon</span>

<span class="hljs-keyword">USER</span> node

<span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">mkdir</span> /home/node/code</span>

<span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /home/node/code</span>

<span class="hljs-keyword">COPY</span><span class="language-bash"> --<span class="hljs-built_in">chown</span>=node:node package-lock.json package.json ./</span>

<span class="hljs-keyword">RUN</span><span class="language-bash"> npm ci</span>

<span class="hljs-keyword">COPY</span><span class="language-bash"> --<span class="hljs-built_in">chown</span>=node:node . .</span>

<span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;nodemon&quot;</span>, <span class="hljs-string">&quot;index.js&quot;</span>]</span>
</code></pre><p>Now we can write our code and every time it save it&#39;ll restart the server from within the container. This will make this super productive to work with!</p>
<p>While we&#39;re about to get to Kubernetes which will handle bigger deployment scenarios than Docker Compose can, you can use <code>docker-compose up --scale web=10</code> to scale up your web container to 10 concurrently running containers. This won&#39;t work at the moment because they&#39;re all trying to listen on the host on port 3000 but we could use something like NGINX or HAProxy to loadbalance amongst the containers. It&#39;s a bit more advance use case and less useful for Compose since at that point you should probably just use Kubernetes or something similar. We&#39;ll approach it in the Kubernetes chapter.</p>
</div><div class="lesson-links"><a href="/lessons/docker-features/networking-with-docker" class="prev">← Previous</a><a href="/lessons/multi-container-projects/kubernetes" class="next">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="40" height="32" viewBox="0 0 40 32"><defs><clipPath id="clip-twitter-social"><rect width="40" height="32"></rect></clipPath></defs><g id="twitter-social" clip-path="url(#clip-twitter-social)"><g id="Group_269" data-name="Group 269" transform="translate(-230.23 -1140.849)"><path id="Path_419" data-name="Path 419" d="M266.12,1148.861v1.035a23.092,23.092,0,0,1-1.507,8.1,24.08,24.08,0,0,1-4.475,7.381,22.175,22.175,0,0,1-7.306,5.4,24.129,24.129,0,0,1-10,2.07,23.7,23.7,0,0,1-6.667-.945,22.83,22.83,0,0,1-5.936-2.655q.959.091,1.963.09a16.518,16.518,0,0,0,5.434-.9,17.111,17.111,0,0,0,4.749-2.52,8.275,8.275,0,0,1-4.749-1.643,7.8,7.8,0,0,1-2.877-3.983,8.268,8.268,0,0,0,1.507.135,8.58,8.58,0,0,0,2.146-.27,8.16,8.16,0,0,1-5.685-4.344,8.326,8.326,0,0,1-.89-3.578v-.135a7.775,7.775,0,0,0,3.744,1.035,8.183,8.183,0,0,1-2.671-2.9,7.817,7.817,0,0,1-.982-3.848,7.948,7.948,0,0,1,1.1-4.05,23.53,23.53,0,0,0,16.895,8.46,9.221,9.221,0,0,1-.183-1.845,7.787,7.787,0,0,1,1.1-4.05,8.216,8.216,0,0,1,2.991-2.948,7.991,7.991,0,0,1,4.087-1.1,8.184,8.184,0,0,1,5.982,2.566,16.087,16.087,0,0,0,5.205-1.98,7.784,7.784,0,0,1-1.393,2.588,8.4,8.4,0,0,1-2.215,1.913,16.856,16.856,0,0,0,4.749-1.305A17.032,17.032,0,0,1,266.12,1148.861Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Excercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul></footer></div><script async="" defer="" src="https://a.holt.courses/latest.js"></script><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"post":{"attributes":{"description":"Learn how to use Docker Compose to coordinate multiple containers for development environments efficiently. Simplify defining relationships between containers using a YAML file, making it easy to manage complex setups with one command. Explore CI/CD integration possibilities and enhance development productivity by leveraging Docker Compose features.","keywords":["Docker Compose","multiple containers","development environments","CI/CD scenarios","YAML file","containers relationship","productivity"]},"html":"\u003cp\u003eThis may be one of the most useful features you learn about Docker. We\u0026#39;ve been mixing various different facets of deploying your app to production and creating development environments. This feature in particular is geared much more for development environments. Many times when you\u0026#39;re developing containers you\u0026#39;re not in just a single container environment (though that does happen too.) When this happens, you need to coordinate multiple containers when you\u0026#39;re doing local dev and you\u0026#39;ve seen in the previous chapter, networking, that it\u0026#39;s possible if a bit annoying.\u003c/p\u003e\n\u003cp\u003eWith Docker Compose we simplify this a lot. Docker Compose allows us the ability to coordinate multiple containers and do so with one YAML file. This is great if you\u0026#39;re developing a Node.js app and it requires a database, caching, or even if you have two+ separate apps in two+ separate containers that depend on each other or all the above! Docker Compose makes it really simple to define the relationship between these containers and get them all running with one \u003ccode\u003edocker compose up\u003c/code\u003e.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eIf you see any commands out there with \u003ccode\u003edocker-compose\u003c/code\u003e (key being the \u003ccode\u003e-\u003c/code\u003e in there) it\u0026#39;s from Docker Compose v1 which is not supported anymore. We are using Docker Compose v2 here. For our purposes there isn\u0026#39;t much difference.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eDo note that Docker does say that Docker Compose is suitable for production environments if you have a single instance running multiple containers. This is atypical for the most part: if you have multiple containers, typically you want the ability to have many instances.\u003c/p\u003e\n\u003cp\u003eIn addition to working very well dev, Docker Compose is very useful in CI/CD scenarios when you want GitHub Actions or some CI/CD provider to spin up multiple environments to quickly run some tests.\u003c/p\u003e\n\u003cp\u003eOkay so let\u0026#39;s get our previous app working: the one with a MongoDB database being connected to by a Node.js app. Create a new file in the root directory of your project called \u003ccode\u003edocker-compose.yml\u003c/code\u003e and put this in there:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003eservices:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eapi:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ebuild:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eapi\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eports:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;8080:8080\u0026quot;\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003elinks:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edb\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eenvironment:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eMONGO_CONNECTION_STRING:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emongodb://db:27017\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003edb:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emongo:7\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eweb:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ebuild:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eweb\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eports:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;8081:80\u0026quot;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis should feel familiar even if it\u0026#39;s new to you. This is basically all of the CLI configurations we were giving to the two containers but captured in a YAML file.\u003c/p\u003e\n\u003cp\u003eIn \u003ccode\u003eservice\u003c/code\u003e we define the containers we need for this particular app. We have two: the \u003ccode\u003eweb\u003c/code\u003e container (which is our app) and the \u003ccode\u003edb\u003c/code\u003e container which is MongoDB. We then identify where the Dockerfile is with \u003ccode\u003ebuild\u003c/code\u003e, which ports to expose in \u003ccode\u003eports\u003c/code\u003e, and the \u003ccode\u003eenvironment\u003c/code\u003e variables using that field.\u003c/p\u003e\n\u003cp\u003eThe one interesting one here is the \u003ccode\u003elinks\u003c/code\u003e field. In this one we\u0026#39;re saying that the \u003ccode\u003eapi\u003c/code\u003e container needs to be connected to the \u003ccode\u003edb\u003c/code\u003e container. This means Docker will start this container first and then network it to the \u003ccode\u003eapi\u003c/code\u003e container. This works the same way as what we were doing in the previous lesson.\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003edb\u003c/code\u003e container is pretty simple: it\u0026#39;s just the \u003ccode\u003emongo\u003c/code\u003e container from Docker Hub. This is actually smart enough to expose 27017 as the port and to make a volume to keep the data around between restarts so we don\u0026#39;t actually have to do anything for that. If you needed any other containers, you\u0026#39;d just put them here in services.\u003c/p\u003e\n\u003cp\u003eWe then have a frontend React.js app that is being built by Parcel.js and served by NGINX.\u003c/p\u003e\n\u003cp\u003eThere\u0026#39;s a lot more to compose files than what I\u0026#39;ve shown you here but I\u0026#39;ll let you explore that on your own time. \u003ca href=\"https://docs.docker.com/compose/compose-file/#compose-file-structure-and-examples\"\u003eClick here\u003c/a\u003e to see the docs to see what else is possible.\u003c/p\u003e\n\u003cp\u003eThis will start and work now, just run \u003ccode\u003edocker compose up\u003c/code\u003e and it\u0026#39;ll get going. I just want to do one thing: let\u0026#39;s make our app even more productive to develop on. Go to your Dockerfile for the app make it read a such:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eIf you change something and want to make sure it builds, make sure to run \u003ccode\u003edocker compose up --build\u003c/code\u003e. Docker Compose isn\u0026#39;t watching for changes when you run up.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-dockerfile\"\u003e\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e node:latest\n\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e npm i -g nodemon\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eUSER\u003c/span\u003e node\n\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e \u003cspan class=\"hljs-built_in\"\u003emkdir\u003c/span\u003e /home/node/code\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eWORKDIR\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e /home/node/code\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e --\u003cspan class=\"hljs-built_in\"\u003echown\u003c/span\u003e=node:node package-lock.json package.json ./\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e npm ci\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e --\u003cspan class=\"hljs-built_in\"\u003echown\u003c/span\u003e=node:node . .\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eCMD\u003c/span\u003e\u003cspan class=\"language-bash\"\u003e [\u003cspan class=\"hljs-string\"\u003e\u0026quot;nodemon\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;index.js\u0026quot;\u003c/span\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eNow we can write our code and every time it save it\u0026#39;ll restart the server from within the container. This will make this super productive to work with!\u003c/p\u003e\n\u003cp\u003eWhile we\u0026#39;re about to get to Kubernetes which will handle bigger deployment scenarios than Docker Compose can, you can use \u003ccode\u003edocker-compose up --scale web=10\u003c/code\u003e to scale up your web container to 10 concurrently running containers. This won\u0026#39;t work at the moment because they\u0026#39;re all trying to listen on the host on port 3000 but we could use something like NGINX or HAProxy to loadbalance amongst the containers. It\u0026#39;s a bit more advance use case and less useful for Compose since at that point you should probably just use Kubernetes or something similar. We\u0026#39;ll approach it in the Kubernetes chapter.\u003c/p\u003e\n","markdown":"\nThis may be one of the most useful features you learn about Docker. We've been mixing various different facets of deploying your app to production and creating development environments. This feature in particular is geared much more for development environments. Many times when you're developing containers you're not in just a single container environment (though that does happen too.) When this happens, you need to coordinate multiple containers when you're doing local dev and you've seen in the previous chapter, networking, that it's possible if a bit annoying.\n\nWith Docker Compose we simplify this a lot. Docker Compose allows us the ability to coordinate multiple containers and do so with one YAML file. This is great if you're developing a Node.js app and it requires a database, caching, or even if you have two+ separate apps in two+ separate containers that depend on each other or all the above! Docker Compose makes it really simple to define the relationship between these containers and get them all running with one `docker compose up`.\n\n\u003e If you see any commands out there with `docker-compose` (key being the `-` in there) it's from Docker Compose v1 which is not supported anymore. We are using Docker Compose v2 here. For our purposes there isn't much difference.\n\nDo note that Docker does say that Docker Compose is suitable for production environments if you have a single instance running multiple containers. This is atypical for the most part: if you have multiple containers, typically you want the ability to have many instances.\n\nIn addition to working very well dev, Docker Compose is very useful in CI/CD scenarios when you want GitHub Actions or some CI/CD provider to spin up multiple environments to quickly run some tests.\n\nOkay so let's get our previous app working: the one with a MongoDB database being connected to by a Node.js app. Create a new file in the root directory of your project called `docker-compose.yml` and put this in there:\n\n```yml\nservices:\n  api:\n    build: api\n    ports:\n      - \"8080:8080\"\n    links:\n      - db\n    environment:\n      MONGO_CONNECTION_STRING: mongodb://db:27017\n  db:\n    image: mongo:7\n  web:\n    build: web\n    ports:\n      - \"8081:80\"\n```\n\nThis should feel familiar even if it's new to you. This is basically all of the CLI configurations we were giving to the two containers but captured in a YAML file.\n\nIn `service` we define the containers we need for this particular app. We have two: the `web` container (which is our app) and the `db` container which is MongoDB. We then identify where the Dockerfile is with `build`, which ports to expose in `ports`, and the `environment` variables using that field.\n\nThe one interesting one here is the `links` field. In this one we're saying that the `api` container needs to be connected to the `db` container. This means Docker will start this container first and then network it to the `api` container. This works the same way as what we were doing in the previous lesson.\n\nThe `db` container is pretty simple: it's just the `mongo` container from Docker Hub. This is actually smart enough to expose 27017 as the port and to make a volume to keep the data around between restarts so we don't actually have to do anything for that. If you needed any other containers, you'd just put them here in services.\n\nWe then have a frontend React.js app that is being built by Parcel.js and served by NGINX.\n\nThere's a lot more to compose files than what I've shown you here but I'll let you explore that on your own time. [Click here][compose] to see the docs to see what else is possible.\n\nThis will start and work now, just run `docker compose up` and it'll get going. I just want to do one thing: let's make our app even more productive to develop on. Go to your Dockerfile for the app make it read a such:\n\n\u003e If you change something and want to make sure it builds, make sure to run `docker compose up --build`. Docker Compose isn't watching for changes when you run up.\n\n```dockerfile\nFROM node:latest\n\nRUN npm i -g nodemon\n\nUSER node\n\nRUN mkdir /home/node/code\n\nWORKDIR /home/node/code\n\nCOPY --chown=node:node package-lock.json package.json ./\n\nRUN npm ci\n\nCOPY --chown=node:node . .\n\nCMD [\"nodemon\", \"index.js\"]\n```\n\nNow we can write our code and every time it save it'll restart the server from within the container. This will make this super productive to work with!\n\nWhile we're about to get to Kubernetes which will handle bigger deployment scenarios than Docker Compose can, you can use `docker-compose up --scale web=10` to scale up your web container to 10 concurrently running containers. This won't work at the moment because they're all trying to listen on the host on port 3000 but we could use something like NGINX or HAProxy to loadbalance amongst the containers. It's a bit more advance use case and less useful for Compose since at that point you should probably just use Kubernetes or something similar. We'll approach it in the Kubernetes chapter.\n\n[compose]: https://docs.docker.com/compose/compose-file/#compose-file-structure-and-examples\n","slug":"docker-compose","title":"Docker Compose","section":"Multi Container Projects","icon":"boxes-stacked","filePath":"/home/runner/work/complete-intro-to-containers-v2/complete-intro-to-containers-v2/lessons/07-multi-container-projects/A-docker-compose.md","nextSlug":"/lessons/multi-container-projects/kubernetes","prevSlug":"/lessons/docker-features/networking-with-docker"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"multi-container-projects","slug":"docker-compose"},"buildId":"nARcRKX1ZlcrYUdSUSS9z","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>