<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/x-icon" href="/images/favicon.ico"/><title>Namespaces – Complete Intro to Containers</title><meta name="description" content="Understand the importance of namespaces and cgroups for security and resource management in server environments. Learn how namespaces can isolate processes to enhance security and prevent unauthorized access in shared server environments, beyond what chroot alone provides."/><meta name="keywords" content="namespaces,cgroups,security,resource management,chroot,process isolation,server environment"/><meta name="og:description" content="Understand the importance of namespaces and cgroups for security and resource management in server environments. Learn how namespaces can isolate processes to enhance security and prevent unauthorized access in shared server environments, beyond what chroot alone provides."/><meta name="og:title" content="Namespaces – Complete Intro to Containers"/><meta name="og:image" content="/images/social-share-cover.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="next-head-count" content="14"/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/cfac17cb37b27821.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/cfac17cb37b27821.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-4e7214a60fad8e88.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-5429a50ba5373c56.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-d2ba44903cd47711.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-564cf6bb10408614.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-ba225542c35827e2.js" defer="" crossorigin=""></script><script src="/_next/static/nARcRKX1ZlcrYUdSUSS9z/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/nARcRKX1ZlcrYUdSUSS9z/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Complete Intro to Containers</a></h1><div class="navbar-info"><a href="https://holt.fyi/containers" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><p>While chroot is a pretty straightforward, namespaces and cgroups are a bit more nebulous to understand but no less important. Both of these next two features are for security and resource management.</p>
<p>Let&#39;s say you&#39;re running a big server that&#39;s in your home and you&#39;re selling space to customers (that you don&#39;t know) to run their code on your server. What sort of concerns would you have about running their &quot;untrusted&quot; code? Let&#39;s say you have Alice and Bob who are running e-commerce services dealing with lots of money. They themselves are good citizens of the servers and minding their own business. But then you have Eve join the server who has other intentions: she wants to steal money, source code, and whatever else she can get her hands on from your other tenants on the server. If just gave all three them unfettered root access to server, what&#39;s to stop Eve from taking everything? Or what if she just wants to disrupt their businesses, even if she&#39;s not stealing anything?</p>
<p>Your first line of defense is that you could log them into chroot&#39;d environments and limit them to only those. Great! Now they can&#39;t see each others&#39; files. Problem solved? Well, no, not quite yet. Despite the fact that she can&#39;t see the files, she can still see all the processes going on on the computer. She can kill processes, unmount filesystem and even hijack processes.</p>
<p>Enter namespaces. Namespaces allow you to hide processes from other processes. If we give each chroot&#39;d environment different sets of namespaces, now Alice, Bob, and Eve can&#39;t see each others&#39; processes (they even get different process PIDs, or process IDs, so they can&#39;t guess what the others have) and you can&#39;t steal or hijack what you can&#39;t see!</p>
<p>There&#39;s a lot more depth to namespaces beyond what I&#39;ve outlined here. The above is describing <em>just</em> the PID namespace. There are more namespaces as well and this will help these containers stay isloated from each other.</p>
<h2>The problem with chroot alone</h2>
<p>Now, this isn&#39;t secure. The only thing we&#39;ve protected is the file system, mostly.</p>
<ol>
<li>chroot in a terminal into our environment</li>
<li>In another terminal, run <code>docker exec -it docker-host bash</code>. This will get another terminal session #2 for us (I&#39;ll refer to the chroot&#39;d environment as #1)</li>
<li>Run <code>tail -f /my-new-root/secret.txt &amp;</code> in #2. This will start an infinitely running process in the background.</li>
<li>Run <code>ps</code> to see the process list in #2 and see the <code>tail</code> process running. Copy the PID (process ID) for the tail process.</li>
<li>In #1, the chroot&#39;d shell, run <code>kill &lt;PID you just copied&gt;</code>. This will kill the tail process from inside the <code>chroot&#39;d</code> environment. This is a problem because that means chroot isn&#39;t enough to isolate someone. We need more barriers. This is just one problem, processes, but it&#39;s illustrative that we need more isolation beyond just the file system.</li>
</ol>
<h2>Safety with namespaces</h2>
<p>So let&#39;s create a chroot&#39;d environment now that&#39;s isolated using namespaces using a new command: <code>unshare</code>. <code>unshare</code> creates a new isolated namespace from its parent (so you, the server provider can&#39;t spy on Bob nor Alice either) and all other future tenants. Run this:</p>
<p><strong>NOTE</strong>: This next command downloads about 150MB and takes at least a few minutes to run. Unlike Docker images, this will redownload it <em>every</em> time you run it and does no caching.</p>
<pre><code class="hljs language-bash"><span class="hljs-comment"># from our chroot&#x27;d environment if you&#x27;re still running it, if not skip this</span>
<span class="hljs-built_in">exit</span>

<span class="hljs-comment">## Install debootstrap</span>
apt-get update -y
apt-get install debootstrap -y
debootstrap --variant=minbase jammy /better-root

<span class="hljs-comment"># head into the new namespace&#x27;d, chroot&#x27;d environment</span>
unshare --mount --uts --ipc --net --pid --fork --user --map-root-user <span class="hljs-built_in">chroot</span> /better-root bash <span class="hljs-comment"># this also chroot&#x27;s for us</span>
mount -t proc none /proc <span class="hljs-comment"># process namespace</span>
mount -t sysfs none /sys <span class="hljs-comment"># filesystem</span>
mount -t tmpfs none /tmp <span class="hljs-comment"># filesystem</span>
</code></pre><p>This will create a new environment that&#39;s isolated on the system with its own PIDs, mounts (like storage and volumes), and network stack. Now we can&#39;t see any of the processes!</p>
<p>Now try our previous exercise again.</p>
<ol>
<li>Run <code>tail -f /my-new-root/secret.txt &amp;</code> from #2 (not the unshare env)</li>
<li>Run <code>ps</code> from #1, grab pid for <code>tail</code></li>
<li>Run <code>kill &lt;pid for tail&gt;</code>, see that it doesn&#39;t work</li>
</ol>
<p>We used namespaces to protect our processes! We could explore the other namespaces but know it&#39;s a similar exercise: using namespaces to restrict capabilities of containers to interfering with other containers (both for nefarious purposes and to protect ourselves from ourselves.)</p>
</div><div class="lesson-links"><a href="/lessons/crafting-containers-by-hand/chroot" class="prev">← Previous</a><a href="/lessons/crafting-containers-by-hand/cgroups" class="next">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="40" height="32" viewBox="0 0 40 32"><defs><clipPath id="clip-twitter-social"><rect width="40" height="32"></rect></clipPath></defs><g id="twitter-social" clip-path="url(#clip-twitter-social)"><g id="Group_269" data-name="Group 269" transform="translate(-230.23 -1140.849)"><path id="Path_419" data-name="Path 419" d="M266.12,1148.861v1.035a23.092,23.092,0,0,1-1.507,8.1,24.08,24.08,0,0,1-4.475,7.381,22.175,22.175,0,0,1-7.306,5.4,24.129,24.129,0,0,1-10,2.07,23.7,23.7,0,0,1-6.667-.945,22.83,22.83,0,0,1-5.936-2.655q.959.091,1.963.09a16.518,16.518,0,0,0,5.434-.9,17.111,17.111,0,0,0,4.749-2.52,8.275,8.275,0,0,1-4.749-1.643,7.8,7.8,0,0,1-2.877-3.983,8.268,8.268,0,0,0,1.507.135,8.58,8.58,0,0,0,2.146-.27,8.16,8.16,0,0,1-5.685-4.344,8.326,8.326,0,0,1-.89-3.578v-.135a7.775,7.775,0,0,0,3.744,1.035,8.183,8.183,0,0,1-2.671-2.9,7.817,7.817,0,0,1-.982-3.848,7.948,7.948,0,0,1,1.1-4.05,23.53,23.53,0,0,0,16.895,8.46,9.221,9.221,0,0,1-.183-1.845,7.787,7.787,0,0,1,1.1-4.05,8.216,8.216,0,0,1,2.991-2.948,7.991,7.991,0,0,1,4.087-1.1,8.184,8.184,0,0,1,5.982,2.566,16.087,16.087,0,0,0,5.205-1.98,7.784,7.784,0,0,1-1.393,2.588,8.4,8.4,0,0,1-2.215,1.913,16.856,16.856,0,0,0,4.749-1.305A17.032,17.032,0,0,1,266.12,1148.861Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Excercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul></footer></div><script async="" defer="" src="https://a.holt.courses/latest.js"></script><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"post":{"attributes":{"description":"Understand the importance of namespaces and cgroups for security and resource management in server environments. Learn how namespaces can isolate processes to enhance security and prevent unauthorized access in shared server environments, beyond what chroot alone provides.","keywords":["namespaces","cgroups","security","resource management","chroot","process isolation","server environment"]},"html":"\u003cp\u003eWhile chroot is a pretty straightforward, namespaces and cgroups are a bit more nebulous to understand but no less important. Both of these next two features are for security and resource management.\u003c/p\u003e\n\u003cp\u003eLet\u0026#39;s say you\u0026#39;re running a big server that\u0026#39;s in your home and you\u0026#39;re selling space to customers (that you don\u0026#39;t know) to run their code on your server. What sort of concerns would you have about running their \u0026quot;untrusted\u0026quot; code? Let\u0026#39;s say you have Alice and Bob who are running e-commerce services dealing with lots of money. They themselves are good citizens of the servers and minding their own business. But then you have Eve join the server who has other intentions: she wants to steal money, source code, and whatever else she can get her hands on from your other tenants on the server. If just gave all three them unfettered root access to server, what\u0026#39;s to stop Eve from taking everything? Or what if she just wants to disrupt their businesses, even if she\u0026#39;s not stealing anything?\u003c/p\u003e\n\u003cp\u003eYour first line of defense is that you could log them into chroot\u0026#39;d environments and limit them to only those. Great! Now they can\u0026#39;t see each others\u0026#39; files. Problem solved? Well, no, not quite yet. Despite the fact that she can\u0026#39;t see the files, she can still see all the processes going on on the computer. She can kill processes, unmount filesystem and even hijack processes.\u003c/p\u003e\n\u003cp\u003eEnter namespaces. Namespaces allow you to hide processes from other processes. If we give each chroot\u0026#39;d environment different sets of namespaces, now Alice, Bob, and Eve can\u0026#39;t see each others\u0026#39; processes (they even get different process PIDs, or process IDs, so they can\u0026#39;t guess what the others have) and you can\u0026#39;t steal or hijack what you can\u0026#39;t see!\u003c/p\u003e\n\u003cp\u003eThere\u0026#39;s a lot more depth to namespaces beyond what I\u0026#39;ve outlined here. The above is describing \u003cem\u003ejust\u003c/em\u003e the PID namespace. There are more namespaces as well and this will help these containers stay isloated from each other.\u003c/p\u003e\n\u003ch2\u003eThe problem with chroot alone\u003c/h2\u003e\n\u003cp\u003eNow, this isn\u0026#39;t secure. The only thing we\u0026#39;ve protected is the file system, mostly.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003echroot in a terminal into our environment\u003c/li\u003e\n\u003cli\u003eIn another terminal, run \u003ccode\u003edocker exec -it docker-host bash\u003c/code\u003e. This will get another terminal session #2 for us (I\u0026#39;ll refer to the chroot\u0026#39;d environment as #1)\u003c/li\u003e\n\u003cli\u003eRun \u003ccode\u003etail -f /my-new-root/secret.txt \u0026amp;\u003c/code\u003e in #2. This will start an infinitely running process in the background.\u003c/li\u003e\n\u003cli\u003eRun \u003ccode\u003eps\u003c/code\u003e to see the process list in #2 and see the \u003ccode\u003etail\u003c/code\u003e process running. Copy the PID (process ID) for the tail process.\u003c/li\u003e\n\u003cli\u003eIn #1, the chroot\u0026#39;d shell, run \u003ccode\u003ekill \u0026lt;PID you just copied\u0026gt;\u003c/code\u003e. This will kill the tail process from inside the \u003ccode\u003echroot\u0026#39;d\u003c/code\u003e environment. This is a problem because that means chroot isn\u0026#39;t enough to isolate someone. We need more barriers. This is just one problem, processes, but it\u0026#39;s illustrative that we need more isolation beyond just the file system.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003eSafety with namespaces\u003c/h2\u003e\n\u003cp\u003eSo let\u0026#39;s create a chroot\u0026#39;d environment now that\u0026#39;s isolated using namespaces using a new command: \u003ccode\u003eunshare\u003c/code\u003e. \u003ccode\u003eunshare\u003c/code\u003e creates a new isolated namespace from its parent (so you, the server provider can\u0026#39;t spy on Bob nor Alice either) and all other future tenants. Run this:\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eNOTE\u003c/strong\u003e: This next command downloads about 150MB and takes at least a few minutes to run. Unlike Docker images, this will redownload it \u003cem\u003eevery\u003c/em\u003e time you run it and does no caching.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e# from our chroot\u0026#x27;d environment if you\u0026#x27;re still running it, if not skip this\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003eexit\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e## Install debootstrap\u003c/span\u003e\napt-get update -y\napt-get install debootstrap -y\ndebootstrap --variant=minbase jammy /better-root\n\n\u003cspan class=\"hljs-comment\"\u003e# head into the new namespace\u0026#x27;d, chroot\u0026#x27;d environment\u003c/span\u003e\nunshare --mount --uts --ipc --net --pid --fork --user --map-root-user \u003cspan class=\"hljs-built_in\"\u003echroot\u003c/span\u003e /better-root bash \u003cspan class=\"hljs-comment\"\u003e# this also chroot\u0026#x27;s for us\u003c/span\u003e\nmount -t proc none /proc \u003cspan class=\"hljs-comment\"\u003e# process namespace\u003c/span\u003e\nmount -t sysfs none /sys \u003cspan class=\"hljs-comment\"\u003e# filesystem\u003c/span\u003e\nmount -t tmpfs none /tmp \u003cspan class=\"hljs-comment\"\u003e# filesystem\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis will create a new environment that\u0026#39;s isolated on the system with its own PIDs, mounts (like storage and volumes), and network stack. Now we can\u0026#39;t see any of the processes!\u003c/p\u003e\n\u003cp\u003eNow try our previous exercise again.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eRun \u003ccode\u003etail -f /my-new-root/secret.txt \u0026amp;\u003c/code\u003e from #2 (not the unshare env)\u003c/li\u003e\n\u003cli\u003eRun \u003ccode\u003eps\u003c/code\u003e from #1, grab pid for \u003ccode\u003etail\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eRun \u003ccode\u003ekill \u0026lt;pid for tail\u0026gt;\u003c/code\u003e, see that it doesn\u0026#39;t work\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eWe used namespaces to protect our processes! We could explore the other namespaces but know it\u0026#39;s a similar exercise: using namespaces to restrict capabilities of containers to interfering with other containers (both for nefarious purposes and to protect ourselves from ourselves.)\u003c/p\u003e\n","markdown":"\nWhile chroot is a pretty straightforward, namespaces and cgroups are a bit more nebulous to understand but no less important. Both of these next two features are for security and resource management.\n\nLet's say you're running a big server that's in your home and you're selling space to customers (that you don't know) to run their code on your server. What sort of concerns would you have about running their \"untrusted\" code? Let's say you have Alice and Bob who are running e-commerce services dealing with lots of money. They themselves are good citizens of the servers and minding their own business. But then you have Eve join the server who has other intentions: she wants to steal money, source code, and whatever else she can get her hands on from your other tenants on the server. If just gave all three them unfettered root access to server, what's to stop Eve from taking everything? Or what if she just wants to disrupt their businesses, even if she's not stealing anything?\n\nYour first line of defense is that you could log them into chroot'd environments and limit them to only those. Great! Now they can't see each others' files. Problem solved? Well, no, not quite yet. Despite the fact that she can't see the files, she can still see all the processes going on on the computer. She can kill processes, unmount filesystem and even hijack processes.\n\nEnter namespaces. Namespaces allow you to hide processes from other processes. If we give each chroot'd environment different sets of namespaces, now Alice, Bob, and Eve can't see each others' processes (they even get different process PIDs, or process IDs, so they can't guess what the others have) and you can't steal or hijack what you can't see!\n\nThere's a lot more depth to namespaces beyond what I've outlined here. The above is describing _just_ the PID namespace. There are more namespaces as well and this will help these containers stay isloated from each other.\n\n## The problem with chroot alone\n\nNow, this isn't secure. The only thing we've protected is the file system, mostly.\n\n1. chroot in a terminal into our environment\n1. In another terminal, run `docker exec -it docker-host bash`. This will get another terminal session #2 for us (I'll refer to the chroot'd environment as #1)\n1. Run `tail -f /my-new-root/secret.txt \u0026` in #2. This will start an infinitely running process in the background.\n1. Run `ps` to see the process list in #2 and see the `tail` process running. Copy the PID (process ID) for the tail process.\n1. In #1, the chroot'd shell, run `kill \u003cPID you just copied\u003e`. This will kill the tail process from inside the `chroot'd` environment. This is a problem because that means chroot isn't enough to isolate someone. We need more barriers. This is just one problem, processes, but it's illustrative that we need more isolation beyond just the file system.\n\n## Safety with namespaces\n\nSo let's create a chroot'd environment now that's isolated using namespaces using a new command: `unshare`. `unshare` creates a new isolated namespace from its parent (so you, the server provider can't spy on Bob nor Alice either) and all other future tenants. Run this:\n\n**NOTE**: This next command downloads about 150MB and takes at least a few minutes to run. Unlike Docker images, this will redownload it _every_ time you run it and does no caching.\n\n```bash\n# from our chroot'd environment if you're still running it, if not skip this\nexit\n\n## Install debootstrap\napt-get update -y\napt-get install debootstrap -y\ndebootstrap --variant=minbase jammy /better-root\n\n# head into the new namespace'd, chroot'd environment\nunshare --mount --uts --ipc --net --pid --fork --user --map-root-user chroot /better-root bash # this also chroot's for us\nmount -t proc none /proc # process namespace\nmount -t sysfs none /sys # filesystem\nmount -t tmpfs none /tmp # filesystem\n```\n\nThis will create a new environment that's isolated on the system with its own PIDs, mounts (like storage and volumes), and network stack. Now we can't see any of the processes!\n\nNow try our previous exercise again.\n\n1. Run `tail -f /my-new-root/secret.txt \u0026` from #2 (not the unshare env)\n1. Run `ps` from #1, grab pid for `tail`\n1. Run `kill \u003cpid for tail\u003e`, see that it doesn't work\n\nWe used namespaces to protect our processes! We could explore the other namespaces but know it's a similar exercise: using namespaces to restrict capabilities of containers to interfering with other containers (both for nefarious purposes and to protect ourselves from ourselves.)\n","slug":"namespaces","title":"Namespaces","section":"Crafting Containers by Hand","icon":"hand-holding-heart","filePath":"/home/runner/work/complete-intro-to-containers-v2/complete-intro-to-containers-v2/lessons/02-crafting-containers-by-hand/C-namespaces.md","nextSlug":"/lessons/crafting-containers-by-hand/cgroups","prevSlug":"/lessons/crafting-containers-by-hand/chroot"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"crafting-containers-by-hand","slug":"namespaces"},"buildId":"nARcRKX1ZlcrYUdSUSS9z","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>